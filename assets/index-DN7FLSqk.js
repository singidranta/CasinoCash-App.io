import{T as de}from"./vendor-4QxL1Nz2.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const q={balances:{gcoin:0,real_balance:0},storageKey:"app_wallet",init(){try{const e=localStorage.getItem(this.storageKey);e?this.balances=JSON.parse(e):(this.balances.gcoin=1e3,this.balances.real_balance=5,this.save())}catch(e){console.error("Failed to load wallet from storage",e)}this.updateDisplay()},getBalance(e="gcoin"){return this.balances[e]},updateBalance(e,t){Object.prototype.hasOwnProperty.call(this.balances,e)?(this.balances[e]=t,this.save(),this.updateDisplay()):console.error(`Currency ${e} not found.`)},add(e,t="gcoin"){Object.prototype.hasOwnProperty.call(this.balances,t)&&(this.balances[t]+=e,this.save(),this.updateDisplay())},subtract(e,t="gcoin"){return Object.prototype.hasOwnProperty.call(this.balances,t)&&this.balances[t]>=e?(this.balances[t]-=e,this.save(),this.updateDisplay(),!0):!1},save(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.balances))}catch(e){console.error("Failed to save wallet to storage",e)}},updateDisplay(){const e=document.getElementById("gcoin-balance");if(e)try{e.textContent=this.balances.gcoin.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}catch{e.textContent=String(this.balances.gcoin)}const t=document.getElementById("real-balance-amount");if(t)try{t.textContent=this.balances.real_balance.toLocaleString("en-US",{style:"currency",currency:"USD"})}catch{t.textContent=`$${Number(this.balances.real_balance).toFixed(2)}`}const n=document.getElementById("game-balance-amount");if(n)try{n.textContent=this.balances.gcoin.toLocaleString("en-US")}catch{n.textContent=String(this.balances.gcoin)}}},be={storageKey:"gcoin_settings",config:{sound:!0,backgroundAnimation:!0,soundVolume:45},init(){try{const e=localStorage.getItem(this.storageKey);e&&(this.config=JSON.parse(e))}catch(e){console.error("Failed to load settings from storage",e)}this.applyToUI(),this.listenForChanges()},save(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.config)),console.log("Settings saved:",this.config)}catch(e){console.error("Failed to save settings to storage",e)}},applyToUI(){const e=document.getElementById("sound-toggle"),t=document.getElementById("bg-animation-toggle"),n=document.getElementById("sound-volume");e&&(e.checked=this.config.sound),t&&(t.checked=this.config.backgroundAnimation),n&&(n.value=this.config.soundVolume)},listenForChanges(){const e=document.getElementById("sound-toggle"),t=document.getElementById("bg-animation-toggle"),n=document.getElementById("sound-volume");e&&e.addEventListener("change",o=>{this.config.sound=o.target.checked,this.save()}),t&&t.addEventListener("change",o=>{this.config.backgroundAnimation=o.target.checked,this.save()}),n&&n.addEventListener("input",o=>{this.config.soundVolume=Number(o.target.value),this.save()})}},ne={lottery:{key:"lottery",name:"Scratch Lottery",description:"Выберите билет (Bronze/Silver/Gold), купите и сотрите поле монеткой, чтобы узнать выигрыш.",type:"lottery",minBet:10,maxBet:250,defaultBet:25,winChance:.2,winMultiplier:5},coinflip:{key:"coinflip",name:"Coin Flip",description:"Выберите сторону и удвойте ставку при верном угадывании.",type:"coinflip",minBet:10,maxBet:300,defaultBet:20,options:["Орёл","Решка"]},crash:{key:"crash",name:"Crash",description:"Следите за ракетой и выводите до взрыва. Настройте автостоп.",type:"crash",minBet:5,maxBet:500,defaultBet:30,multipliers:[1.5,2,3,5],maxAutoStop:10}};function ae(e,t){const n=ne[e];if(!n)return 0;const o=Number.isFinite(t)?t:n.defaultBet;return Math.min(Math.max(o,n.minBet),n.maxBet)}function we(e){return ne[e]||null}function oe(e,t){const n=ne[e];if(!n)return!1;const o=ae(e,t??n.defaultBet);return q.getBalance("gcoin")>=o}function ie(e,t){const n=ae(e,t);if(!q.subtract(n,"gcoin"))throw new Error("Недостаточно gcoin для ставки");return n}function z(e){e>0&&q.add(e,"gcoin")}function Ee(e,t){const n=ae("coinflip",t),o=Math.random()<.5?"Орёл":"Решка",a=e===o,s=a?n*2:0;return z(s),{win:a,bet:n,reward:s,result:o,message:a?`Вы угадали! Баланс пополнен на ${s.toFixed(2)} gcoin.`:`Выпало "${o}". Ставка проиграна.`}}function Ce(e,t={}){if(!e)throw new Error("ScratchEngine: hostEl is required");const n={radius:Math.max(6,t.radius||16),cover:t.cover||"#B7BEC5",opacity:t.opacity??1,mode:t.mode==="clear"?"clear":"sealed",progressSampleEvery:t.progressSampleEvery||8,revealFadeMs:t.revealFadeMs||240},o=e.style.position;getComputedStyle(e).position==="static"&&(e.style.position="relative");const a=document.createElement("canvas");a.className="scratch-canvas",a.style.position="absolute",a.style.inset="0",a.style.touchAction="none",a.style.userSelect="none",e.appendChild(a);const s=a.getContext("2d",{willReadFrequently:!0}),c=Math.min(2,window.devicePixelRatio||1);let r=0,i=0;function l(){const w=e.getBoundingClientRect();r=Math.max(1,Math.floor(w.width)),i=Math.max(1,Math.floor(w.height)),a.width=Math.floor(r*c),a.height=Math.floor(i*c),a.style.width=r+"px",a.style.height=i+"px",s.setTransform(c,0,0,c,0,0),v()}function v(){s.globalCompositeOperation="source-over",s.clearRect(0,0,r,i);const w=n.mode==="clear"?.06:n.opacity;s.globalAlpha=w,s.fillStyle=n.cover,s.fillRect(0,0,r,i),s.globalAlpha=1,s.globalCompositeOperation="destination-out"}let g=!1,b=0,B=0,k=0,C=!1;const L=new Set;function h(){const w=u();L.forEach(I=>{try{I(w)}catch{}})}function F(w){g=!0;const{x:I,y:U}=P(w);b=I,B=U,p(I,U),k=0}function A(w){if(!g)return;const{x:I,y:U}=P(w);f(b,B,I,U),b=I,B=U,++k%n.progressSampleEvery===0&&h()}function _(){g&&(g=!1,h())}function P(w){const I=a.getBoundingClientRect(),U=(w.touches?w.touches[0].clientX:w.clientX)??0,G=(w.touches?w.touches[0].clientY:w.clientY)??0;return{x:U-I.left,y:G-I.top}}function p(w,I){s.beginPath(),s.arc(w,I,n.radius,0,Math.PI*2),s.fill()}function f(w,I,U,G){const d=U-w,x=G-I,E=Math.hypot(d,x),S=Math.max(1,n.radius*.6),T=d/E,O=x/E;for(let W=0;W<=E;W+=S)p(w+T*W,I+O*W)}function u(){try{const w=Math.max(1,Math.floor(r*c)),I=Math.max(1,Math.floor(i*c)),{data:U}=s.getImageData(0,0,w,I);let G=0;for(let x=3;x<U.length;x+=4)U[x]<16&&G++;const d=w*I;return d?G/d:0}catch{return 0}}function m(w){return typeof w=="function"&&L.add(w),()=>L.delete(w)}function y(){C||(C=!0,a.style.transition=`opacity ${n.revealFadeMs}ms ease`,a.style.opacity="0",setTimeout(()=>{a.remove()},n.revealFadeMs+20),R())}function N(){C=!1,a.style.opacity="1",a.isConnected||e.appendChild(a),v()}function R(){a.removeEventListener("pointerdown",F),window.removeEventListener("pointermove",A),window.removeEventListener("pointerup",_),window.removeEventListener("resize",l)}function J(){R(),a.isConnected&&a.remove(),o&&(e.style.position=o),L.clear()}return a.addEventListener("pointerdown",F),window.addEventListener("pointermove",A,{passive:!0}),window.addEventListener("pointerup",_),window.addEventListener("resize",l),l(),{onProgress:m,getProgressRatio:u,reveal:y,reset:N,destroy:J,canvas:a}}function xe(e){const t="lottery",n=[{id:"bronze",name:"Bronze",color:"#CD7F32",winChance:.08,multiplier:3},{id:"silver",name:"Silver",color:"#C0C0C0",winChance:.12,multiplier:5},{id:"gold",name:"Gold",color:"#D4AF37",winChance:.16,multiplier:8}];let o=e.info.defaultBet,a=n[1],s=null,c=null,r=null,i=null,l=!1,v=null,g="sealed";function b(f){const u=e.info,m=Number(f);Number.isFinite(m)?o=Math.min(Math.max(m,u.minBet),u.maxBet):o=u.defaultBet,e.setStakeInfo(o)}function B(){const f=document.createElement("div");f.className="game-control-group";const u=document.createElement("label");u.textContent="Размер ставки";const m=document.createElement("input");m.type="range",m.min=String(e.info.minBet),m.max=String(e.info.maxBet),m.step="1",m.value=String(o),m.className="stake-slider";const y=document.createElement("input");return y.type="number",y.min=String(e.info.minBet),y.max=String(e.info.maxBet),y.step="1",y.value=String(o),y.className="stake-input",m.addEventListener("input",N=>{y.value=N.target.value,b(N.target.value)}),y.addEventListener("change",N=>{b(N.target.value),m.value=String(o),y.value=String(o)}),f.appendChild(u),f.appendChild(m),f.appendChild(y),f}function k(){const f=document.createElement("div");return f.className="variants-row",n.forEach(u=>{const m=document.createElement("button");m.type="button",m.className="variant-card",m.dataset.id=u.id,m.style.setProperty("--variant-color",u.color),m.innerHTML=`
        <span class="variant-dot" style="background:${u.color}"></span>
        <span class="variant-name">${u.name}</span>
        <span class="variant-odds">${Math.round(u.winChance*100)}% · x${u.multiplier}</span>
      `,u.id===a.id&&m.classList.add("active"),m.addEventListener("click",()=>{a=u,e.setMultiplierInfo(a.multiplier,!0);for(const y of f.querySelectorAll(".variant-card"))y.classList.remove("active");m.classList.add("active"),L()}),f.appendChild(m)}),f}function C(){const f=document.createElement("div");f.className="game-control-group";const u=document.createElement("label");u.textContent="Режим билета";const m=document.createElement("div");m.className="game-controls-row";const y=document.createElement("button");y.type="button",y.className="btn btn-secondary",y.textContent="Запечатанный";const N=document.createElement("button");N.type="button",N.className="btn btn-secondary",N.textContent="Прозрачный";function R(){y.classList.toggle("active",g==="sealed"),N.classList.toggle("active",g==="clear")}return y.addEventListener("click",()=>{g="sealed",R(),L()}),N.addEventListener("click",()=>{g="clear",R(),L()}),R(),m.appendChild(y),m.appendChild(N),f.appendChild(u),f.appendChild(m),f}function L(){if(!c)return;c.innerHTML="",r=document.createElement("div"),r.className=`ticket-card variant-${a.id}`,r.style.setProperty("--variant-color",a.color);const f=document.createElement("div");f.className="ticket-header",f.innerHTML=`
      <div class="ticket-title">
        <span class="ticket-name">${a.name} Ticket</span>
        <span class="ticket-multiplier">x${a.multiplier}</span>
      </div>
      <div class="ticket-hint">Сотри серое поле монеткой</div>
    `;const u=document.createElement("div");u.className="ticket-body";const m=document.createElement("div");m.className="ticket-result",m.innerHTML='<div class="result-placeholder">Купите билет, чтобы стереть</div>',u.appendChild(m),r.appendChild(f),r.appendChild(u),c.appendChild(r)}function h(){if(!r)return;i&&(i.destroy(),i=null);const f=r.querySelector(".ticket-body");i=Ce(f,{radius:18,cover:"#C1C7CE",mode:g}),i.onProgress(u=>{!l&&u>.6&&(l=!0,i.reveal(),F())})}function F(){v&&(v.reward>0&&z(v.reward),e.setStatus(v.message,v.win?"win":"lose"),s&&(s.disabled=!1,s.textContent="Купить ещё"))}function A(){if(!oe(t,o)){e.setStatus("Недостаточно gcoin для покупки билета.","lose");return}const f=ie(t,o),u=Math.random()<a.winChance,m=u?f*a.multiplier:0;v={win:u,bet:f,reward:m,multiplier:a.multiplier,message:u?`Повезло! Выигрыш ${m.toFixed(2)} gcoin (x${a.multiplier}).`:"Увы, без выигрыша. Попробуйте другой билет!"};const y=r.querySelector(".ticket-result");y.innerHTML=u?`<div class="result-win">ДЖЕКПОТ!<br><span class="amount">+${m.toFixed(2)} gcoin</span></div>`:'<div class="result-lose">Не выиграл</div>',l=!1,h(),e.setStatus("Стирайте монеткой серое поле, чтобы узнать результат…",""),s&&(s.disabled=!0,s.textContent="Стирайте…")}function _(){const f=document.createElement("div");return f.className="game-controls-row",s=document.createElement("button"),s.type="button",s.className="btn btn-primary",s.textContent="Купить билет",s.addEventListener("click",A),f.appendChild(s),f}function P(){e.configEl.appendChild(B()),e.configEl.appendChild(k()),e.configEl.appendChild(C()),c=document.createElement("div"),c.className="scratch-stage",e.stageEl.appendChild(c),L(),e.controlsEl.appendChild(_()),e.setMultiplierInfo(a.multiplier,!0),e.setStatus("Выберите билет, настройте ставку и купите билет.","")}function p(){i&&(i.destroy(),i=null),s=null,c=null,r=null,v=null,l=!1}return b(o),{mount:P,destroy:p}}function Se(e){var P;const t="coinflip",n=e.info;let o=n.defaultBet,a=((P=n.options)==null?void 0:P[0])||"Орёл",s=!1,c=null,r=null,i=null;const l=()=>{c&&(clearTimeout(c),c=null)},v=p=>{o=Number(p),Number.isFinite(o)||(o=n.defaultBet),o=Math.min(Math.max(o,n.minBet),n.maxBet),e.setStakeInfo(o)},g=p=>{a=p,e.setStatus(`Вы выбрали ${p}.`,"")},b=p=>p==="Решка"?"tails":"heads",B=()=>{const p=document.createElement("div");p.className="game-control-group";const f=document.createElement("label");f.textContent="Размер ставки";const u=document.createElement("input");u.type="range",u.min=String(n.minBet),u.max=String(n.maxBet),u.step="1",u.value=String(o),u.className="stake-slider";const m=document.createElement("input");return m.type="number",m.min=String(n.minBet),m.max=String(n.maxBet),m.step="1",m.value=String(o),m.className="stake-input",u.addEventListener("input",y=>{m.value=y.target.value,v(y.target.value)}),m.addEventListener("change",y=>{const N=Number(y.target.value);v(N),u.value=String(o),m.value=String(o)}),p.appendChild(f),p.appendChild(u),p.appendChild(m),p},k=()=>{var m;const p=document.createElement("div");p.className="game-control-group";const f=document.createElement("label");f.textContent="Сторона монеты",p.appendChild(f);const u=document.createElement("div");return u.className="coin-choice-row",(m=n.options)==null||m.forEach(y=>{const N=document.createElement("button");N.type="button",N.className="btn btn-secondary btn-choice",N.textContent=y,y===a&&N.classList.add("active"),N.addEventListener("click",()=>{u.querySelectorAll(".btn-choice").forEach(R=>R.classList.remove("active")),N.classList.add("active"),g(y)}),u.appendChild(N)}),p.appendChild(u),p},C=()=>{const p=document.createElement("div");p.className="coin-stage";const f=document.createElement("div");f.className="coin",f.dataset.side=b(a);const u=document.createElement("div");u.className="coin-face coin-front",u.textContent="Орёл";const m=document.createElement("div");return m.className="coin-face coin-back",m.textContent="Решка",f.appendChild(u),f.appendChild(m),p.appendChild(f),r=f,p},L=(p,f)=>{if(!r)return;r.classList.remove("coin-win","coin-lose"),r.classList.add("coin-flip");const u=f.win;c=setTimeout(()=>{r.classList.remove("coin-flip"),r.style.transform=p==="Решка"?"rotateY(180deg)":"rotateY(0deg)",r.dataset.side=b(p),r.classList.add(u?"coin-win":"coin-lose"),e.setStatus(f.message,u?"win":"lose"),s=!1,i&&(i.disabled=!1,i.textContent="Бросить монету")},1500)},h=()=>{if(s)return;if(!oe(t,o)){e.setStatus("Недостаточно gcoin для ставки.","lose");return}const p=ie(t,o),f=Ee(a,p);e.setStatus("Монета в полёте...",""),s=!0,i&&(i.disabled=!0,i.textContent="Бросаем..."),l(),L(f.result,f)},F=()=>{const p=document.createElement("div");return p.className="game-controls-row",i=document.createElement("button"),i.type="button",i.className="btn btn-primary",i.textContent="Бросить монету",i.addEventListener("click",h),p.appendChild(i),p},A=()=>{e.configEl.appendChild(B()),e.configEl.appendChild(k()),e.stageEl.appendChild(C()),e.controlsEl.appendChild(F()),e.setStatus("Выберите сторону и сделайте ставку.",""),e.setMultiplierInfo(1,!1)},_=()=>{l(),r=null,i=null,s=!1};return v(o),g(a),{mount:A,destroy:_}}function Be(e){var G;const t="crash",n=e.info;let o=n.defaultBet,a=((G=n.multipliers)==null?void 0:G[1])||2,s=!1,c=null,r=null,i=null,l=null,v=null,g=null,b=[],B=0,k=0,C=!1,L=!1,h=0,F=0;const A=d=>{o=Number(d),Number.isFinite(o)||(o=n.defaultBet),o=Math.min(Math.max(o,n.minBet),n.maxBet),e.setStakeInfo(o)},_=d=>{var x;a=Number(d),Number.isFinite(a)||(a=((x=n.multipliers)==null?void 0:x[0])||1.5),a=Math.min(Math.max(a,1.1),n.maxAutoStop||10),e.setMultiplierInfo(a,!0)},P=()=>{const d=document.createElement("div");d.className="game-control-group";const x=document.createElement("label");x.textContent="Размер ставки";const E=document.createElement("input");E.type="range",E.min=String(n.minBet),E.max=String(n.maxBet),E.step="1",E.value=String(o),E.className="stake-slider";const S=document.createElement("input");return S.type="number",S.min=String(n.minBet),S.max=String(n.maxBet),S.step="1",S.value=String(o),S.className="stake-input",E.addEventListener("input",T=>{S.value=T.target.value,A(T.target.value)}),S.addEventListener("change",T=>{const O=Number(T.target.value);A(O),E.value=String(o),S.value=String(o)}),d.appendChild(x),d.appendChild(E),d.appendChild(S),d},p=()=>{const d=document.createElement("div");d.className="game-control-group";const x=document.createElement("label");x.textContent="Автостоп (множитель)";const E=document.createElement("input");E.type="range",E.min="1.1",E.max=String(n.maxAutoStop||10),E.step="0.1",E.value=String(a),E.className="stake-slider";const S=document.createElement("input");return S.type="number",S.min="1.1",S.max=String(n.maxAutoStop||10),S.step="0.1",S.value=String(a),S.className="stake-input",E.addEventListener("input",T=>{S.value=T.target.value,_(T.target.value)}),S.addEventListener("change",T=>{const O=Number(T.target.value);_(O),E.value=String(a),S.value=String(a)}),d.appendChild(x),d.appendChild(E),d.appendChild(S),d},f=()=>{const d=document.createElement("div");d.className="crash-stage";const x=document.createElement("canvas");return x.width=360,x.height=200,x.className="crash-canvas",d.appendChild(x),r=x,i=x.getContext("2d"),u(),d},u=()=>{!i||!r||(i.clearRect(0,0,r.width,r.height),i.fillStyle="rgba(18, 16, 42, 0.75)",i.fillRect(0,0,r.width,r.height),i.strokeStyle="rgba(125, 120, 255, 0.28)",i.lineWidth=1,i.setLineDash([4,6]),i.beginPath(),i.moveTo(0,r.height-40),i.lineTo(r.width,40),i.stroke(),i.setLineDash([]),i.fillStyle="rgba(143, 150, 199, 0.8)",i.font="12px Manrope",i.fillText("x1",6,r.height-10),i.fillText("x2",80,r.height-80),i.fillText("x5",160,r.height-140),i.fillText("x10",r.width-36,60))},m=(d,x,E)=>{if(!i||!r)return;cancelAnimationFrame(c),u(),i.strokeStyle=E?"rgba(95, 255, 211, 0.85)":"rgba(255, 92, 154, 0.85)",i.lineWidth=3,i.beginPath();const S=Math.max(x,a,...d,1.5),T=(r.height-40)/Math.max(S,1.2),O=(r.width-40)/d.length;d.forEach((ve,re)=>{const ce=20+O*re,le=r.height-ve*T;re===0?i.moveTo(ce,le):i.lineTo(ce,le)}),i.stroke(),i.fillStyle=E?"rgba(95, 255, 211, 0.9)":"rgba(255, 92, 154, 0.9)",i.beginPath();const W=d[d.length-1]||1,Y=20+O*(d.length-1),ye=r.height-W*T;i.arc(Y,ye,6,0,Math.PI*2),i.fill(),i.fillStyle="rgba(143, 150, 199, 0.85)",i.font="13px Manrope",i.textAlign="right",i.fillText(`Краш: x${x.toFixed(2)}`,r.width-12,24),i.fillText(`Автостоп: x${a.toFixed(2)}`,r.width-12,42),i.textAlign="left"};function y(d){return d<=0?1:d<=2?1+.05*d:d<=3?1.1+.1*(d-2):d<=4?1.2+.2*(d-3):1.4+.3*(d-4)}function N(d){return d<=1?0:d<=1.1?(d-1)/.05:d<=1.2?2+(d-1.1)/.1:d<=1.4?3+(d-1.2)/.2:4+(d-1.4)/.3}function R(d){const x=b.concat([d]);m(x,h,!C||L)}const J=()=>{if(s)return;if(!oe(t,o)){e.setStatus("Недостаточно gcoin для ставки.","lose");return}k=ie(t,o),s=!0,C=!1,L=!1,b=[],u(),e.setStatus("Ракета взлетает... Ждите множитель или выведите вручную.",""),l&&(l.disabled=!0),v&&(v.disabled=!1),g&&(g.disabled=!1);const d=(n==null?void 0:n.volatility)||3.2,x=1+Math.random()*d;h=Number(x.toFixed(2)),F=N(h),B=performance.now();const E=()=>{const T=(performance.now()-B)/1e3,O=y(T);b.push(O);const W=T>=F&&!C&&!L;if(!C&&!L&&O>=a){const Y=Number((k*a).toFixed(2));z(Y),L=!0,s=!1,R(O),e.setStatus(`Вы вывели на x${a.toFixed(2)}. Профит ${Y.toFixed(2)} gcoin.`,"win"),l&&(l.disabled=!1),g&&(g.disabled=!0);return}if(W){C=!0,s=!1,R(O),e.setStatus(`Краш на x${h.toFixed(2)}. Вы не успели вывести.`,"lose"),l&&(l.disabled=!1),g&&(g.disabled=!0);return}R(O),c=requestAnimationFrame(E)};c=requestAnimationFrame(E)},w=()=>{const d=document.createElement("div");return d.className="game-controls-row",l=document.createElement("button"),l.type="button",l.className="btn btn-primary",l.textContent="Старт",l.addEventListener("click",J),g=document.createElement("button"),g.type="button",g.className="btn btn-secondary",g.textContent="Вывести сейчас",g.disabled=!0,g.addEventListener("click",()=>{if(!s||C||L)return;const E=(performance.now()-B)/1e3,S=y(E),T=Number((k*S).toFixed(2));z(T),L=!0,s=!1,R(S),e.setStatus(`Вы вывели на x${S.toFixed(2)}. Профит ${T.toFixed(2)} gcoin.`,"win"),l&&(l.disabled=!1),g&&(g.disabled=!0)}),v=document.createElement("button"),v.type="button",v.className="btn btn-secondary",v.textContent="Очистить график",v.addEventListener("click",()=>{u(),e.setStatus("График очищен. Настройте автостоп и ставку.","")}),d.appendChild(l),d.appendChild(g),d.appendChild(v),d},I=()=>{e.configEl.appendChild(P()),e.configEl.appendChild(p()),e.stageEl.appendChild(f()),e.controlsEl.appendChild(w()),e.setStatus("Настройте ставку и автостоп, затем запускайте раунд.","")},U=()=>{cancelAnimationFrame(c),c=null,r=null,i=null,l=null,v=null,g=null,b=[],s=!1};return A(o),_(a),{mount:I,destroy:U}}const Le={lottery:xe,coinflip:Se,crash:Be};function ke({titleEl:e,descriptionEl:t,configEl:n,stageEl:o,controlsEl:a,statusEl:s,stakeInfoEl:c,multiplierInfoEl:r}){const i={activeKey:null,activeInstance:null},l=h=>{h&&(h.innerHTML="")},v=(h="",F="")=>{s&&(s.textContent=h,s.classList.remove("game-result-win","game-result-lose"),F==="win"?s.classList.add("game-result-win"):F==="lose"&&s.classList.add("game-result-lose"))},g=h=>{c&&(typeof h=="number"?c.textContent=`Ставка: ${h.toFixed(2)} gcoin`:c.textContent=h||"Ставка: —")},b=(h,F=!0)=>{if(r){if(!F){r.style.display="none";return}r.style.display="",r.textContent=`Множитель: x${Number(h||1).toFixed(2)}`}},B=()=>{if(v("Выберите игру, чтобы начать раунд.",""),g("Ставка: —"),b(1,!1),l(n),l(o),l(a),o){const h=document.createElement("div");h.className="game-placeholder",h.textContent="Выберите игру из главного зала",o.appendChild(h)}},k=()=>{i.activeInstance&&typeof i.activeInstance.destroy=="function"&&i.activeInstance.destroy(),i.activeInstance=null,i.activeKey=null},C=h=>{var p;const F=Le[h],A=we(h);if(!F||!A){console.warn("[GameManager] Unknown game key:",h);return}if(k(),l(n),l(o),l(a),v("Настройте параметры и нажмите старт.",""),typeof A.defaultBet=="number"?g(A.defaultBet):typeof A.minBet=="number"?g(A.minBet):g("Ставка: —"),A.type==="crash"){const f=((p=A.multipliers)==null?void 0:p[0])||1.5;b(f,!0)}else b(1,!1);e&&(e.textContent=A.name),t&&(t.textContent=A.description);const P=F({configEl:n,stageEl:o,controlsEl:a,setStatus:v,setStakeInfo:g,setMultiplierInfo:b,info:A});P&&typeof P.mount=="function"?(P.mount(),i.activeInstance=P,i.activeKey=h):(console.warn("[GameManager] Invalid game instance for key:",h),B())},L=()=>{k(),e&&(e.textContent="Выберите игру"),t&&(t.textContent="Откройте игру из каталога, чтобы начать."),B()};return L(),{openGame:C,reset:L,hasActiveGame:()=>!!i.activeKey,getActiveGameKey:()=>i.activeKey}}function Ne(e){const t={home:document.getElementById("home-view"),game:document.getElementById("game-view"),wallet:document.getElementById("wallet-view")},n=document.querySelectorAll(".nav-item"),o=()=>{Object.values(t).forEach(c=>{c&&(c.style.display="none")})},a=c=>{n.forEach(r=>{r.classList.toggle("active",r.dataset.view===c)})},s=c=>{o();const r=t[c]||t.home;r&&(r.style.display="flex")};return n.forEach(c=>{const r=c.dataset.view||"home";c.addEventListener("click",i=>{i.preventDefault(),s(r),a(r),r==="home"&&e.reset()})}),s("home"),a("home"),{switchView:s,updateNavActive:a}}function Me(){const e=document.getElementById("settings-modal"),t=document.querySelector(".settings-btn"),n=document.getElementById("close-settings-btn");t&&t.addEventListener("click",()=>{e&&(e.style.display="flex")}),n&&n.addEventListener("click",()=>{e&&(e.style.display="none")}),e&&e.addEventListener("click",o=>{o.target===e&&(e.style.display="none")})}function Ae(){return ke({titleEl:document.getElementById("active-game-title"),descriptionEl:document.getElementById("active-game-description"),configEl:document.getElementById("game-config"),stageEl:document.getElementById("game-stage"),controlsEl:document.getElementById("game-controls"),statusEl:document.getElementById("game-status"),stakeInfoEl:document.getElementById("game-stake-info"),multiplierInfoEl:document.getElementById("game-multiplier-info")})}function Ie(e,t){document.querySelectorAll(".game-card").forEach(o=>{o.addEventListener("click",()=>{const a=o.dataset.game;a&&(t.switchView("game"),t.updateNavActive("game"),e.openGame(a))})})}function Te(e,t){const n=document.getElementById("back-to-library");n&&n.addEventListener("click",()=>{e.reset(),t.switchView("home"),t.updateNavActive("home")})}function Fe(){const e=Ae(),t=Ne(e);Me(),Ie(e,t),Te(e,t)}const M={adsgram:{blockId:"15234",sdkUrl:"https://sad.adsgram.ai/js/sad.min.js"},monetag:{scriptUrl:"https://libtl.com/sdk.js",showFunctionName:"show_9922551",defaultOptions:{type:"end",requestVar:"ad_reward_button",timeout:15e3,catchIfNoFeed:!0}},tonConnect:{manifestUrl:"https://singidranta.github.io/CasinoCash-App.io/tonconnect-manifest.json",buttonContainerId:"ton-connect-button",addressElementId:"ton-address",recipientAddress:"EQC-your-ton-address",purchase:{amount:"2",currency:"TON",description:"Gcoin top-up"}},rewards:{perAdUsd:.1},rotationKey:"monetag"},H=new Map;let V=null;function Ue(){return typeof window<"u"&&window.Telegram&&window.Telegram.WebApp}function $e(){return!String(M.monetag.scriptUrl).startsWith("REPLACE_")&&!0}function Q(){return!String(M.adsgram.blockId).startsWith("REPLACE_")}function Pe(){const e=Number(localStorage.getItem("adsgram_disabled_until")||0);return Number.isFinite(e)?e:0}function Z(){return Pe()>Date.now()}function Oe(e,t=""){try{const n=Date.now()+Math.max(0,e);localStorage.setItem("adsgram_disabled_until",String(n)),console.warn("[AdsGram] Temporarily disabled until",new Date(n).toISOString(),t||"")}catch{}}function ee(e){return new Promise((t,n)=>{if(!e||e.startsWith("REPLACE_WITH"))return n(new Error("Script URL is not configured"));if(H.has(e)){const c=H.get(e);if(c==="loaded")return t();if(c&&c.then)return c.then(t).catch(n)}const o=document.querySelector(`script[src="${e}"]`);if(o)return o.dataset.loaded="true",H.set(e,"loaded"),t();const a=document.createElement("script");a.src=e,a.async=!0,a.referrerPolicy="no-referrer-when-downgrade",a.addEventListener("load",()=>{a.dataset.loaded="true",H.set(e,"loaded"),t()}),a.addEventListener("error",()=>{H.delete(e),n(new Error(`Failed to load script ${e}`))}),document.head.appendChild(a);const s=new Promise((c,r)=>{a.addEventListener("load",()=>c()),a.addEventListener("error",()=>r(new Error(`Failed to load script ${e}`)))});H.set(e,s)})}async function ge(){if(!Q())return console.warn("[AdsGram] blockId is not configured. Skipping init."),null;if(Z())return console.warn("[AdsGram] temporarily disabled, skipping init"),null;try{!window.Telegram&&!document.querySelector('script[src="https://telegram.org/js/telegram-web-app.js"]')&&await ee("https://telegram.org/js/telegram-web-app.js")}catch(e){console.warn("[AdsGram] Telegram SDK not loaded:",e.message)}if(window.Adsgram&&typeof window.Adsgram.init=="function"||await ee(M.adsgram.sdkUrl),!window.Adsgram||typeof window.Adsgram.init!="function")return console.warn("[AdsGram] SDK not available after script load"),null;try{return V=window.Adsgram.init({blockId:M.adsgram.blockId}),V}catch(e){return console.warn("[AdsGram] init failed:",e.message),null}}async function ue(){try{if(V||await ge(),!V||!V.show)throw new Error("AdsGram controller not available");return{ok:!0,provider:"adsgram",payload:await V.show()}}catch(e){try{const t=String((e==null?void 0:e.message)||e||"").toLowerCase();(t.includes("not active")||t.includes("moderation"))&&Oe(6*60*60*1e3,"block inactive/moderation")}catch{}return{ok:!1,provider:"adsgram",error:e}}}async function me(){var e;try{if(!M.monetag.scriptUrl||M.monetag.scriptUrl.startsWith("REPLACE_"))throw new Error("Monetag script URL is not configured");await ee(M.monetag.scriptUrl);const t=M.monetag.showFunctionName,n=t&&window[t];if(typeof n!="function")throw new Error(`Monetag show function ${t} is not available`);const o={...M.monetag.defaultOptions};if(Ue())try{const s=(e=window.Telegram.WebApp.initDataUnsafe)==null?void 0:e.user;s&&s.id&&(o.ymid=String(s.id))}catch{}return{ok:!0,provider:"monetag",payload:await n(o)}}catch(t){return{ok:!1,provider:"monetag",error:t}}}function te(){const e=M.rotationKey,t=localStorage.getItem(e);return t==="monetag"||t==="adsgram"?t:(localStorage.setItem(e,"monetag"),"monetag")}function Re(){const e=M.rotationKey,n=te()==="monetag"?"adsgram":"monetag";return localStorage.setItem(e,n),n}const pe={async init(){Q()&&!Z()&&ge().catch(e=>console.warn("[AdsGram] preload failed:",e.message)),te()},async showRewardedAd(){var s,c,r;const e=[];if($e()&&e.push("monetag"),Q()&&!Z()&&e.push("adsgram"),e.length===0)return{ok:!1,error:{message:"No ad providers configured or available"}};const t=te();let n=e.includes(t)?t:e[0],o=e.find(i=>i!==n);Re();let a=n==="monetag"?await me():await ue();if(a.ok)return a;if(o){let i=o==="monetag"?await me():await ue();return i.ok?i:{ok:!1,error:{first:(s=a.error)==null?void 0:s.message,second:(c=i.error)==null?void 0:c.message}}}return{ok:!1,error:{first:(r=a.error)==null?void 0:r.message}}}},_e="https://raw.githubusercontent.com/ton-connect/sdk/main/assets/tonconnect-logo.png";function D(...e){console.info("[TonConnect]",...e)}function fe(e,t){console.groupCollapsed(`[TonConnect] ${e}`);try{t()}finally{console.groupEnd()}}function K(...e){console.error("[TonConnect]",...e)}let $=null,j=null;const Ge=new Set;function X(e){se(e),Ge.forEach(t=>{try{t(e||null)}catch(n){console.warn("[TonConnect] subscriber error",n)}});try{window.dispatchEvent(new CustomEvent("ton-status",{detail:e||null}))}catch{}}function De(e){const t=e,n=window.location.href.split("#")[0].split("?")[0],o=n.endsWith("/")?n:`${n.substring(0,n.lastIndexOf("/")+1)}`;try{const s=new URL(t,o).toString();return D("Resolved manifest URL:",s),s}catch(a){K("Manifest URL resolution failed relative to page. Falling back to origin root.",a);try{return new URL(t,window.location.origin+"/").toString()}catch(s){throw new Error(`TonConnect invalid manifest URL: ${s.message}`)}}}function Ke(){try{const{origin:e,pathname:t}=window.location,n=t.endsWith("/")?t:t.substring(0,t.lastIndexOf("/")+1);return`${e}${n}`}catch(e){return K("Failed to derive app base URL:",e),null}}function We(e,t){if(!e||typeof e!="object")return{manifest:null,changed:!1};const n={...e};let o=!1;const a=Ke();n.url||a&&(n.url=a,o=!0),n.name||(n.name=(M==null?void 0:M.appName)||document.title||"TonConnect App",o=!0);const s=typeof n.iconUrl=="string"?n.iconUrl:"";return(!s||s.endsWith(".svg")||s.startsWith("data:image/svg"))&&(n.iconUrl=_e,o=!0),{manifest:n,changed:o}}async function qe(e){try{fe(`Manifest preflight → ${e}`,()=>{D("Initiating fetch with no-cache headers")});const t=await fetch(e,{method:"GET",cache:"no-store",mode:"cors"});if(!t.ok){const a=await t.text().catch(()=>"<<unreadable>>");throw new Error(`HTTP ${t.status}. Body preview: ${a.slice(0,180)}`)}const n=await t.clone().text().catch(()=>null),o=(()=>{try{return JSON.parse(n||"{}")}catch(a){return K("Manifest JSON parse failed:",a),null}})();return fe("Manifest content preview",()=>{D("HTTP status:",t.status,t.statusText),o?D("Fields:",JSON.stringify(o,null,2)):D("Raw text:",n==null?void 0:n.slice(0,500))}),{manifestJson:o,manifestText:n}}catch(t){throw K("Manifest fetch failed:",t),t}}function se(e){var n;const t=document.getElementById((n=M.tonConnect)==null?void 0:n.addressElementId);if(t)if(e!=null&&e.address){const o=`${e.address.slice(0,6)}...${e.address.slice(-4)}`;t.textContent=o,t.dataset.full=e.address,t.classList.add("connected")}else t.textContent="Не подключено",t.dataset.full="",t.classList.remove("connected")}function He(){var t;const e=document.getElementById((t=M.tonConnect)==null?void 0:t.addressElementId);e&&(e.style.cursor="pointer",e.addEventListener("click",async()=>{const n=e.dataset.full||"";if(n)try{await navigator.clipboard.writeText(n);const o=e.textContent;e.textContent="Copied!",setTimeout(()=>se(($==null?void 0:$.account)||null)||(e.textContent=o),1e3)}catch(o){console.warn("[TonConnect] clipboard copy failed",o)}}))}async function Ve(){var c,r,i;const e=(c=M.tonConnect)==null?void 0:c.buttonContainerId,t=De((r=M.tonConnect)==null?void 0:r.manifestUrl),n=await qe(t);let o=t;const{manifest:a,changed:s}=We((n==null?void 0:n.manifestJson)||null);s&&a&&D("Manifest needs adjustments (url/icon). Update the remote file if possible.",a);try{$=new de({manifestUrl:o,buttonRootId:e,language:"ru"}),D("TonConnectUI instance created. Version:",((i=de)==null?void 0:i.version)||"unknown")}catch(l){throw K("Failed to create TonConnectUI instance:",l,l==null?void 0:l.stack),l}He(),se($.account),$.onStatusChange(l=>{D("Status change → wallet",l?l.account:"null"),X(l)},l=>{K("Status change error:",l),X(null)});try{const l=await $.connectionRestored;D("connectionRestored resolved →",l),l&&X($.account)}catch(l){K("Connection restoration failed:",l)}return $}function he(){return j||(j=Ve().catch(e=>(K("init failed:",(e==null?void 0:e.message)||e),$=null,j=null,null))),j}function Ye(){return $}async function je(){const e=await he();return e||K("ensureTonConnectReady → TonConnectUI unavailable"),e}function ze(){var e;$&&((e=$.openModal)==null||e.call($))}function Je(e){const t=Number(e);return!Number.isFinite(t)||t<=0?null:BigInt(Math.round(t*1e9)).toString()}async function Xe(){var c,r,i,l,v,g,b,B,k;const e=Ye()||await je();if(!e){alert("TonConnect UI не инициализирован. Проверьте manifestUrl.");return}if(!e.account){ze(),alert("Подключите TON-кошелёк, чтобы продолжить.");return}const t=(c=M.tonConnect)==null?void 0:c.recipientAddress,n=Je((i=(r=M.tonConnect)==null?void 0:r.purchase)==null?void 0:i.amount);if(!n){alert("Параметры TON-покупки не настроены.");return}const o={address:t,amount:n},a=(v=(l=M.tonConnect)==null?void 0:l.purchase)==null?void 0:v.payloadHex;a&&(o.payload=a);const s={validUntil:Math.round(Date.now()/1e3)+(((b=(g=M.tonConnect)==null?void 0:g.purchase)==null?void 0:b.ttl)||300),messages:[o]};try{await e.sendTransaction(s);const C=((k=(B=M.tonConnect)==null?void 0:B.purchase)==null?void 0:k.successMessage)||"Платёж в TON отправлен! После подтверждения пополните баланс вручную.";alert(C)}catch(C){console.warn("[TON Purchase] sendTransaction failed",C);const L=(C==null?void 0:C.message)||"Не удалось отправить транзакцию TON.";alert(L)}}function Qe(){const e=document.getElementById("exchange-modal"),t=document.getElementById("exchange-btn"),n=document.getElementById("close-exchange-btn"),o=document.getElementById("confirm-exchange-btn"),a=document.getElementById("ad-reward-btn"),s=document.getElementById("buy-ton-btn"),c=document.getElementById("from-amount"),r=document.getElementById("from-currency"),i=document.getElementById("to-amount"),l=document.getElementById("to-currency"),v=200;t&&t.addEventListener("click",()=>{e&&(e.style.display="flex")}),n&&n.addEventListener("click",()=>{e&&(e.style.display="none")});const g=()=>{const b=parseFloat((c==null?void 0:c.value)||"0")||0,B=(r==null?void 0:r.value)||"real_balance";let k=0;B==="real_balance"?(l&&(l.value="gcoin"),k=b*v):(l&&(l.value="real_balance"),k=b/v),i&&(i.value=k.toFixed(2))};if(c&&c.addEventListener("input",g),r&&r.addEventListener("change",g),o&&o.addEventListener("click",()=>{const b=parseFloat((c==null?void 0:c.value)||"0")||0,B=(r==null?void 0:r.value)||"real_balance",k=(l==null?void 0:l.value)||"gcoin",C=parseFloat((i==null?void 0:i.value)||"0")||0;if(b<=0){alert("Введите корректную сумму / Please enter a valid amount.");return}if(q.getBalance(B)<b){alert("Недостаточно средств для обмена / Insufficient funds for this exchange.");return}q.subtract(b,B),q.add(C,k),alert("Обмен выполнен! / Exchange successful!"),e&&(e.style.display="none"),c&&(c.value=""),i&&(i.value="")}),a){const b=a.innerHTML;a.addEventListener("click",async()=>{try{a.disabled=!0,a.innerHTML="Поиск рекламы… / Searching for ad…";const B=await pe.showRewardedAd();if(B&&B.ok){const k=B.provider,C=B.payload||{};let L=!1;if(k==="monetag"?L=C&&C.reward_event_type==="valued":k==="adsgram"&&(L=!!C&&C.done===!0),L){const h=Number(M.rewards.perAdUsd||.1);q.add(h,"real_balance"),alert(`Реклама просмотрена! Начислено $${h.toFixed(2)}.
Ad viewed successfully! You've earned $${h.toFixed(2)}.`)}else alert(`Реклама не была досмотрена до конца. Награда не начислена.
Ad was not completed. No reward.`)}else alert(`Ошибка рекламы, попробуйте позже.
Ad error, please try again later.`)}catch(B){console.warn("Ad error:",B),alert(`Ошибка рекламы, попробуйте позже.
Ad error, please try again later.`)}finally{a.disabled=!1,a.innerHTML=b}})}s&&s.addEventListener("click",()=>{Xe()})}window.addEventListener("DOMContentLoaded",()=>{try{window.Telegram&&window.Telegram.WebApp&&typeof window.Telegram.WebApp.ready=="function"&&window.Telegram.WebApp.ready()}catch{}q.init(),be.init(),Fe(),pe.init(),Qe(),he(),console.log("App initialized.")});
