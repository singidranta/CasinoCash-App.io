import{T as ce}from"./vendor-4QxL1Nz2.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const U={balances:{gcoin:0,real_balance:0},storageKey:"app_wallet",init(){try{const e=localStorage.getItem(this.storageKey);e?this.balances=JSON.parse(e):(this.balances.gcoin=1e3,this.balances.real_balance=5,this.save())}catch(e){console.error("Failed to load wallet from storage",e)}this.updateDisplay()},getBalance(e="gcoin"){return this.balances[e]},updateBalance(e,t){Object.prototype.hasOwnProperty.call(this.balances,e)?(this.balances[e]=t,this.save(),this.updateDisplay()):console.error(`Currency ${e} not found.`)},add(e,t="gcoin"){Object.prototype.hasOwnProperty.call(this.balances,t)&&(this.balances[t]+=e,this.save(),this.updateDisplay())},subtract(e,t="gcoin"){return Object.prototype.hasOwnProperty.call(this.balances,t)&&this.balances[t]>=e?(this.balances[t]-=e,this.save(),this.updateDisplay(),!0):!1},save(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.balances))}catch(e){console.error("Failed to save wallet to storage",e)}},updateDisplay(){const e=document.getElementById("gcoin-balance");if(e)try{e.textContent=this.balances.gcoin.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}catch{e.textContent=String(this.balances.gcoin)}const t=document.getElementById("real-balance-amount");if(t)try{t.textContent=this.balances.real_balance.toLocaleString("en-US",{style:"currency",currency:"USD"})}catch{t.textContent=`$${Number(this.balances.real_balance).toFixed(2)}`}const n=document.getElementById("game-balance-amount");if(n)try{n.textContent=this.balances.gcoin.toLocaleString("en-US")}catch{n.textContent=String(this.balances.gcoin)}}},Ce={storageKey:"gcoin_settings",config:{sound:!0,backgroundAnimation:!0,soundVolume:45,tonRecipient:""},init(){try{const e=localStorage.getItem(this.storageKey);e&&(this.config=JSON.parse(e));const t=localStorage.getItem("ton_recipient");t&&(this.config.tonRecipient=t)}catch(e){console.error("Failed to load settings from storage",e)}this.applyToUI(),this.listenForChanges(),this.bindWalletStatus()},save(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.config)),console.log("Settings saved:",this.config)}catch(e){console.error("Failed to save settings to storage",e)}},applyToUI(){const e=document.getElementById("sound-toggle"),t=document.getElementById("bg-animation-toggle"),n=document.getElementById("sound-volume"),o=document.getElementById("ton-recipient-input");e&&(e.checked=this.config.sound),t&&(t.checked=this.config.backgroundAnimation),n&&(n.value=this.config.soundVolume),o&&(o.value=this.config.tonRecipient||"")},listenForChanges(){const e=document.getElementById("sound-toggle"),t=document.getElementById("bg-animation-toggle"),n=document.getElementById("sound-volume"),o=document.getElementById("ton-recipient-input");e&&e.addEventListener("change",a=>{this.config.sound=a.target.checked,this.save()}),t&&t.addEventListener("change",a=>{this.config.backgroundAnimation=a.target.checked,this.save()}),n&&n.addEventListener("input",a=>{this.config.soundVolume=Number(a.target.value),this.save()}),o&&o.addEventListener("change",a=>{const i=String(a.target.value||"").trim();this.config.tonRecipient=i;try{localStorage.setItem("ton_recipient",i)}catch{}this.save()})},bindWalletStatus(){const e=document.querySelector(".wallet-placeholder"),t=n=>{if(e)if(n){const o=`${n.slice(0,6)}...${n.slice(-4)}`;e.textContent=`Подключено: ${o}`}else e.textContent="Не подключено"};try{window.addEventListener("ton-status",n=>{var o;t(((o=n==null?void 0:n.detail)==null?void 0:o.address)||null)})}catch{}}},ae={lottery:{key:"lottery",name:"Scratch Lottery",description:"Выберите билет (Bronze/Silver/Gold), купите и сотрите поле монеткой, чтобы узнать выигрыш.",type:"lottery",minBet:10,maxBet:250,defaultBet:25,winChance:.2,winMultiplier:5},coinflip:{key:"coinflip",name:"Coin Flip",description:"Выберите сторону и удвойте ставку при верном угадывании.",type:"coinflip",minBet:10,maxBet:300,defaultBet:20,options:["Орёл","Решка"]},crash:{key:"crash",name:"Crash",description:"Следите за ракетой и выводите до взрыва. Настройте автостоп.",type:"crash",minBet:5,maxBet:500,defaultBet:30,multipliers:[1.5,2,3,5],maxAutoStop:10}};function oe(e,t){const n=ae[e];if(!n)return 0;const o=Number.isFinite(t)?t:n.defaultBet;return Math.min(Math.max(o,n.minBet),n.maxBet)}function Ie(e){return ae[e]||null}function ie(e,t){const n=ae[e];if(!n)return!1;const o=oe(e,t??n.defaultBet);return U.getBalance("gcoin")>=o}function se(e,t){const n=oe(e,t);if(!U.subtract(n,"gcoin"))throw new Error("Недостаточно gcoin для ставки");return n}function Q(e){e>0&&U.add(e,"gcoin")}function Se(e,t){const n=oe("coinflip",t),o=Math.random()<.5?"Орёл":"Решка",a=e===o,i=a?n*2:0;return Q(i),{win:a,bet:n,reward:i,result:o,message:a?`Вы угадали! Баланс пополнен на ${i.toFixed(2)} gcoin.`:`Выпало "${o}". Ставка проиграна.`}}function Te(e,t={}){if(!e)throw new Error("ScratchEngine: hostEl is required");const n={radius:Math.max(6,t.radius||16),cover:t.cover||"#B7BEC5",opacity:t.opacity??1,mode:t.mode==="clear"?"clear":"sealed",progressSampleEvery:t.progressSampleEvery||8,revealFadeMs:t.revealFadeMs||240},o=e.style.position;getComputedStyle(e).position==="static"&&(e.style.position="relative");const a=document.createElement("canvas");a.className="scratch-canvas",a.style.position="absolute",a.style.inset="0",a.style.touchAction="none",a.style.userSelect="none",e.appendChild(a);const i=a.getContext("2d",{willReadFrequently:!0}),s=Math.min(2,window.devicePixelRatio||1);let r=0,d=0;function c(){const y=e.getBoundingClientRect();r=Math.max(1,Math.floor(y.width)),d=Math.max(1,Math.floor(y.height)),a.width=Math.floor(r*s),a.height=Math.floor(d*s),a.style.width=r+"px",a.style.height=d+"px",i.setTransform(s,0,0,s,0,0),l()}function l(){i.globalCompositeOperation="source-over",i.clearRect(0,0,r,d);const y=n.mode==="clear"?.06:n.opacity;i.globalAlpha=y,i.fillStyle=n.cover,i.fillRect(0,0,r,d),i.globalAlpha=1,i.globalCompositeOperation="destination-out"}let p=!1,f=0,v=0,I=0,b=!1;const T=new Set;function h(){const y=M();T.forEach(_=>{try{_(y)}catch{}})}function x(y){p=!0;const{x:_,y:k}=E(y);f=_,v=k,u(_,k),I=0}function L(y){if(!p)return;const{x:_,y:k}=E(y);w(f,v,_,k),f=_,v=k,++I%n.progressSampleEvery===0&&h()}function C(){p&&(p=!1,h())}function E(y){const _=a.getBoundingClientRect(),k=(y.touches?y.touches[0].clientX:y.clientX)??0,F=(y.touches?y.touches[0].clientY:y.clientY)??0;return{x:k-_.left,y:F-_.top}}function u(y,_){i.beginPath(),i.arc(y,_,n.radius,0,Math.PI*2),i.fill()}function w(y,_,k,F){const m=k-y,S=F-_,O=Math.hypot(m,S),Y=Math.max(1,n.radius*.6),V=m/O,X=S/O;for(let H=0;H<=O;H+=Y)u(y+V*H,_+X*H)}function M(){try{const y=Math.max(1,Math.floor(r*s)),_=Math.max(1,Math.floor(d*s)),{data:k}=i.getImageData(0,0,y,_);let F=0;for(let S=3;S<k.length;S+=4)k[S]<16&&F++;const m=y*_;return m?F/m:0}catch{return 0}}function B(y){return typeof y=="function"&&T.add(y),()=>T.delete(y)}function P(){b||(b=!0,a.style.transition=`opacity ${n.revealFadeMs}ms ease`,a.style.opacity="0",setTimeout(()=>{a.remove()},n.revealFadeMs+20),N())}function $(){b=!1,a.style.opacity="1",a.isConnected||e.appendChild(a),l()}function N(){a.removeEventListener("pointerdown",x),window.removeEventListener("pointermove",L),window.removeEventListener("pointerup",C),window.removeEventListener("resize",c)}function q(){N(),a.isConnected&&a.remove(),o&&(e.style.position=o),T.clear()}return a.addEventListener("pointerdown",x),window.addEventListener("pointermove",L,{passive:!0}),window.addEventListener("pointerup",C),window.addEventListener("resize",c),c(),{onProgress:B,getProgressRatio:M,reveal:P,reset:$,destroy:q,canvas:a}}function _e(e){const t="lottery",n=[{id:"bronze",name:"Bronze",color:"#CD7F32",winChance:.08,multiplier:3,price:15},{id:"silver",name:"Silver",color:"#C0C0C0",winChance:.12,multiplier:5,price:25},{id:"gold",name:"Gold",color:"#D4AF37",winChance:.16,multiplier:8,price:40}];let o=n[1],a=o.price,i=null,s=null,r=null,d=!1,c=null;function l(){var C;return(C=e.stageEl)==null?void 0:C.closest(".game-panel")}function p(C){const E=l();E&&(E.classList.toggle("lottery-select-mode",C==="select"),E.classList.toggle("lottery-scratch-mode",C==="scratch"))}function f(){e.configEl&&(e.configEl.innerHTML=""),e.controlsEl&&(e.controlsEl.innerHTML="")}function v(){p("select"),f(),e.stageEl&&(e.stageEl.innerHTML="");const C=document.createElement("div");C.className="lottery-select-grid",n.forEach(E=>{const u=document.createElement("button");u.type="button",u.className="lottery-select-card",u.style.setProperty("--variant-color",E.color),u.innerHTML=`
        <div class="ls-title">
          <span class="ls-name">${E.name}</span>
          <span class="ls-mult">x${E.multiplier}</span>
        </div>
        <div class="ls-meta">
          <span class="ls-price">${E.price.toFixed(2)} gcoin</span>
          <span class="ls-chance">${Math.round(E.winChance*100)}%</span>
        </div>
      `,u.addEventListener("click",()=>T(E)),C.appendChild(u)}),e.stageEl.appendChild(C),e.setStatus("Выберите билет",""),e.setStakeInfo("Ставка: —"),e.setMultiplierInfo(1,!1)}function I(){p("scratch"),f(),i&&(i.destroy(),i=null),e.stageEl.innerHTML="",s=document.createElement("div"),s.className=`ticket-card variant-${o.id}`,s.style.setProperty("--variant-color",o.color);const C=document.createElement("div");C.className="ticket-header",C.innerHTML=`
      <div class="ticket-title">
        <span class="ticket-name">${o.name} Ticket</span>
        <span class="ticket-multiplier">x${o.multiplier}</span>
      </div>
      <div class="ticket-hint">Сотри серое поле монеткой</div>
    `;const E=document.createElement("div");E.className="ticket-body";const u=document.createElement("div");u.className="ticket-result",u.innerHTML='<div class="result-placeholder">Стирайте, чтобы узнать результат</div>',E.appendChild(u),s.appendChild(C),s.appendChild(E),e.stageEl.appendChild(s),b(),e.setStakeInfo(a),e.setMultiplierInfo(o.multiplier,!0),e.setStatus("Стирайте монеткой серое поле, чтобы узнать результат…","");const w=document.createElement("div");w.className="lottery-scratch-actions",c=document.createElement("button"),c.type="button",c.className="btn btn-primary",c.textContent="Стирайте…",c.disabled=!0,c.addEventListener("click",()=>{c.disabled||T(o)}),w.appendChild(c),e.stageEl.appendChild(w)}function b(){if(!s)return;i&&(i.destroy(),i=null);const C=s.querySelector(".ticket-body");i=Te(C,{radius:22,cover:"#C1C7CE",mode:"sealed"}),i.onProgress(E=>{!d&&E>.6&&(d=!0,i.reveal(),h())})}function T(C){if(o=C,a=o.price,!ie(t,a)){e.setStatus("Недостаточно gcoin для покупки билета.","lose");return}const E=se(t,a),u=Math.random()<o.winChance,w=u?E*o.multiplier:0;r={win:u,bet:E,reward:w,multiplier:o.multiplier,message:u?`Повезло! Выигрыш ${w.toFixed(2)} gcoin (x${o.multiplier}).`:"Увы, без выигрыша. Попробуйте другой билет!"},I();const M=s.querySelector(".ticket-result");M.innerHTML=u?`<div class="result-win">ДЖЕКПОТ!<br><span class="amount">+${w.toFixed(2)} gcoin</span></div>`:'<div class="result-lose">Не выиграл</div>',d=!1}function h(){r&&(r.reward>0&&Q(r.reward),e.setStatus(r.message,r.win?"win":"lose"),c&&(c.disabled=!1,c.textContent=`Купить ещё за ${a.toFixed(2)} gcoin`))}function x(){v()}function L(){const C=l();C&&(C.classList.remove("lottery-select-mode"),C.classList.remove("lottery-scratch-mode")),i&&(i.destroy(),i=null),s=null,r=null,d=!1,c=null,e.stageEl&&(e.stageEl.innerHTML=""),f()}return{mount:x,destroy:L}}function Ae(e){const t="coinflip",n=e.info;let o=n.defaultBet,a="Орёл",i=!1,s=null,r=null,d=null;const c=()=>{var u;return(u=e.stageEl)==null?void 0:u.closest(".game-panel")},l=u=>{const w=c();w&&w.classList.toggle("coin-minimal-mode",!0)},p=()=>{e.configEl&&(e.configEl.innerHTML=""),e.controlsEl&&(e.controlsEl.innerHTML="")},f=()=>{s&&(clearTimeout(s),s=null)},v=u=>{o=Number(u),Number.isFinite(o)||(o=n.defaultBet),o=Math.min(Math.max(o,n.minBet),n.maxBet),e.setStakeInfo(o)},I=u=>{a=u},b=u=>u==="Решка"?"tails":"heads",T=()=>{const u=document.createElement("div");return u.className="coin-stake-chips",Array.from(new Set([n.minBet,n.defaultBet,Math.round((n.minBet+n.maxBet)/2),n.maxBet])).filter(Number.isFinite).sort((M,B)=>M-B).forEach(M=>{const B=document.createElement("button");B.type="button",B.className="coin-stake-chip",B.textContent=`${M}`,M===o&&B.classList.add("active"),B.addEventListener("click",()=>{o=M,e.setStakeInfo(o),u.querySelectorAll(".coin-stake-chip").forEach(P=>P.classList.remove("active")),B.classList.add("active")}),u.appendChild(B)}),u},h=()=>{const u=document.createElement("div");u.className="coin-stage";const w=document.createElement("div");w.className="coin",w.dataset.side=b(a);const M=document.createElement("div");M.className="coin-face coin-front",M.textContent="";const B=document.createElement("div");B.className="coin-face coin-back",B.textContent="",w.appendChild(M),w.appendChild(B),u.appendChild(w);const P=document.createElement("div");P.className="coin-stake-controls";const $=T(),N=document.createElement("input");return N.type="number",N.className="coin-stake-input",N.min=String(n.minBet),N.max=String(n.maxBet),N.step="1",N.placeholder=String(o),N.value=String(o),N.addEventListener("change",q=>{const y=Number(q.target.value);Number.isFinite(y)&&(o=Math.min(Math.max(y,n.minBet),n.maxBet),e.setStakeInfo(o),$.querySelectorAll(".coin-stake-chip").forEach(_=>_.classList.toggle("active",Number(_.textContent)===o)),N.value=String(o))}),P.appendChild($),P.appendChild(N),u.appendChild(P),r=w,r.addEventListener("click",L),u},x=(u,w)=>{if(!r)return;r.classList.remove("coin-win","coin-lose"),r.classList.add("coin-flip");const M=w.win;s=setTimeout(()=>{r.classList.remove("coin-flip"),r.style.transform=u==="Решка"?"rotateY(180deg)":"rotateY(0deg)",r.dataset.side=b(u),r.classList.add(M?"coin-win":"coin-lose"),e.setStatus(w.message,M?"win":"lose"),i=!1,r.style.pointerEvents="",d&&(d.disabled=!1,d.textContent="Бросить монету")},1500)},L=()=>{if(i)return;if(!ie(t,o)){e.setStatus("Недостаточно gcoin для ставки.","lose");return}const u=se(t,o),w=Se(a,u);e.setStatus("Монета в полёте...",""),i=!0,r.style.pointerEvents="none",f(),x(w.result,w)},C=()=>{l(),p(),e.stageEl.appendChild(h()),e.setStatus("",""),e.setMultiplierInfo(1,!1)},E=()=>{f(),r=null,d=null,i=!1;const u=c();u&&u.classList.remove("coin-minimal-mode")};return v(o),I(a),{mount:C,destroy:E}}function Le(e){var F;const t="crash",n=e.info;let o=n.defaultBet,a=((F=n.multipliers)==null?void 0:F[1])||2,i=!1,s=null,r=null,d=null,c=null,l=null,p=null,f=null,v=0,I=0,b=!1,T=!1,h=0,x=0;const L=()=>{var m;return(m=e.stageEl)==null?void 0:m.closest(".game-panel")},C=m=>{const S=L();S&&S.classList.toggle("crash-minimal-mode",!0)},E=()=>{e.configEl&&(e.configEl.innerHTML=""),e.controlsEl&&(e.controlsEl.innerHTML="")},u=m=>{o=Number(m),Number.isFinite(o)||(o=n.defaultBet),o=Math.min(Math.max(o,n.minBet),n.maxBet),e.setStakeInfo(o)},w=m=>{var S;a=Number(m),Number.isFinite(a)||(a=((S=n.multipliers)==null?void 0:S[0])||1.5),a=Math.min(Math.max(a,1.1),n.maxAutoStop||10),e.setMultiplierInfo(a,!0)},M=()=>{const m=document.createElement("div");m.className="crash-stage";const S=document.createElement("div");S.className="crash-meter";const O=document.createElement("div");return O.className="crash-meter-value",O.textContent="x1.00",S.appendChild(O),m.appendChild(S),r=S,d=O,B(),m};function B(){!r||!d||(r.classList.remove("win","lose","active"),d.textContent="x1.00")}function P(m,S){!r||!d||(d.textContent=`x${m.toFixed(2)}`,S==="active"?(r.classList.add("active"),r.classList.remove("win","lose")):S==="win"?(r.classList.add("win"),r.classList.remove("lose","active")):S==="lose"&&(r.classList.add("lose"),r.classList.remove("win","active")))}function $(m){return m<=0?1:m<=2?1+.05*m:m<=3?1.1+.1*(m-2):m<=4?1.2+.2*(m-3):1.4+.3*(m-4)}function N(m){return m<=1?0:m<=1.1?(m-1)/.05:m<=1.2?2+(m-1.1)/.1:m<=1.4?3+(m-1.2)/.2:4+(m-1.4)/.3}const q=()=>{if(i)return;if(!ie(t,o)){e.setStatus("Недостаточно gcoin для ставки.","lose");return}I=se(t,o),i=!0,b=!1,T=!1,B(),P(1,"active"),e.setStatus("",""),c&&(c.disabled=!0),l&&(l.disabled=!1);const m=(n==null?void 0:n.volatility)||3.2,S=1+Math.random()*m;h=Number(S.toFixed(2)),x=N(h),v=performance.now();const O=()=>{const V=(performance.now()-v)/1e3,X=$(V),H=V>=x&&!b&&!T;if(!b&&!T&&X>=a){const ve=Number((I*a).toFixed(2));Q(ve),T=!0,i=!1,P(a,"win"),e.setStatus("",""),c&&(c.disabled=!1),l&&(l.disabled=!0);return}if(H){b=!0,i=!1,P(h,"lose"),e.setStatus("",""),c&&(c.disabled=!1),l&&(l.disabled=!0);return}P(X,"active"),s=requestAnimationFrame(O)};s=requestAnimationFrame(O)},y=()=>{const m=document.createElement("div");return m.className="crash-actions",p=document.createElement("input"),p.type="number",p.min=String(n.minBet),p.max=String(n.maxBet),p.step="1",p.value=String(o),p.className="crash-input",p.placeholder="Ставка",p.addEventListener("change",S=>{u(Number(S.target.value)),p.value=String(o)}),f=document.createElement("input"),f.type="number",f.min="1.1",f.max=String(n.maxAutoStop||10),f.step="0.1",f.value=String(a),f.className="crash-input",f.placeholder="Автостоп",f.addEventListener("change",S=>{w(Number(S.target.value)),f.value=String(a)}),c=document.createElement("button"),c.type="button",c.className="btn btn-primary",c.textContent="Старт",c.addEventListener("click",q),l=document.createElement("button"),l.type="button",l.className="btn btn-secondary",l.textContent="Вывести",l.disabled=!0,l.addEventListener("click",()=>{if(!i||b||T)return;const O=(performance.now()-v)/1e3,Y=$(O),V=Number((I*Y).toFixed(2));Q(V),T=!0,i=!1,P(Y,"win"),e.setStatus("",""),c&&(c.disabled=!1),l&&(l.disabled=!0)}),m.appendChild(p),m.appendChild(f),m.appendChild(c),m.appendChild(l),m},_=()=>{C(),E(),e.stageEl.appendChild(M()),e.controlsEl.appendChild(y()),e.setStatus("","")},k=()=>{cancelAnimationFrame(s),s=null,r=null,d=null,c=null,l=null,p=null,f=null,i=!1;const m=L();m&&m.classList.remove("crash-minimal-mode")};return u(o),w(a),{mount:_,destroy:k}}const Me={lottery:_e,coinflip:Ae,crash:Le};function Be({titleEl:e,descriptionEl:t,configEl:n,stageEl:o,controlsEl:a,statusEl:i,stakeInfoEl:s,multiplierInfoEl:r}){const d={activeKey:null,activeInstance:null},c=h=>{h&&(h.innerHTML="")},l=(h="",x="")=>{i&&(i.textContent=h,i.classList.remove("game-result-win","game-result-lose"),x==="win"?i.classList.add("game-result-win"):x==="lose"&&i.classList.add("game-result-lose"))},p=h=>{s&&(typeof h=="number"?s.textContent=`Ставка: ${h.toFixed(2)} gcoin`:s.textContent=h||"Ставка: —")},f=(h,x=!0)=>{if(r){if(!x){r.style.display="none";return}r.style.display="",r.textContent=`Множитель: x${Number(h||1).toFixed(2)}`}},v=()=>{if(l("Выберите игру, чтобы начать раунд.",""),p("Ставка: —"),f(1,!1),c(n),c(o),c(a),o){const h=document.createElement("div");h.className="game-placeholder",h.textContent="Выберите игру из главного зала",o.appendChild(h)}},I=()=>{d.activeInstance&&typeof d.activeInstance.destroy=="function"&&d.activeInstance.destroy(),d.activeInstance=null,d.activeKey=null},b=h=>{var u;const x=Me[h],L=Ie(h);if(!x||!L){console.warn("[GameManager] Unknown game key:",h);return}if(I(),c(n),c(o),c(a),l("Настройте параметры и нажмите старт.",""),typeof L.defaultBet=="number"?p(L.defaultBet):typeof L.minBet=="number"?p(L.minBet):p("Ставка: —"),L.type==="crash"){const w=((u=L.multipliers)==null?void 0:u[0])||1.5;f(w,!0)}else f(1,!1);e&&(e.textContent=L.name),t&&(t.textContent=L.description);const E=x({configEl:n,stageEl:o,controlsEl:a,setStatus:l,setStakeInfo:p,setMultiplierInfo:f,info:L});E&&typeof E.mount=="function"?(E.mount(),d.activeInstance=E,d.activeKey=h):(console.warn("[GameManager] Invalid game instance for key:",h),v())},T=()=>{I(),e&&(e.textContent="Выберите игру"),t&&(t.textContent="Откройте игру из каталога, чтобы начать."),v()};return T(),{openGame:b,reset:T,hasActiveGame:()=>!!d.activeKey,getActiveGameKey:()=>d.activeKey}}function xe(e){const t={home:document.getElementById("home-view"),game:document.getElementById("game-view"),wallet:document.getElementById("wallet-view")},n=document.querySelectorAll(".nav-item"),o=()=>{Object.values(t).forEach(s=>{s&&(s.style.display="none")})},a=s=>{n.forEach(r=>{r.classList.toggle("active",r.dataset.view===s)})},i=s=>{o();const r=t[s]||t.home;r&&(r.style.display="flex")};return n.forEach(s=>{const r=s.dataset.view||"home";s.addEventListener("click",d=>{d.preventDefault(),i(r),a(r),r==="home"&&e.reset()})}),i("home"),a("home"),{switchView:i,updateNavActive:a}}function Ne(){const e=document.getElementById("settings-modal"),t=document.querySelector(".settings-btn"),n=document.getElementById("close-settings-btn");t&&t.addEventListener("click",()=>{e&&(e.style.display="flex")}),n&&n.addEventListener("click",()=>{e&&(e.style.display="none")}),e&&e.addEventListener("click",o=>{o.target===e&&(e.style.display="none")})}function ke(){return Be({titleEl:document.getElementById("active-game-title"),descriptionEl:document.getElementById("active-game-description"),configEl:document.getElementById("game-config"),stageEl:document.getElementById("game-stage"),controlsEl:document.getElementById("game-controls"),statusEl:document.getElementById("game-status"),stakeInfoEl:document.getElementById("game-stake-info"),multiplierInfoEl:document.getElementById("game-multiplier-info")})}function Re(e,t){document.querySelectorAll(".game-card").forEach(o=>{o.addEventListener("click",()=>{const a=o.dataset.game;a&&(t.switchView("game"),t.updateNavActive("game"),e.openGame(a))})})}function Pe(e,t){const n=document.getElementById("back-to-library");n&&n.addEventListener("click",()=>{e.reset(),t.switchView("home"),t.updateNavActive("home")})}function Oe(){const e=ke(),t=xe(e);Ne(),Re(e,t),Pe(e,t)}var me;const fe=((me=import.meta)==null?void 0:me.env)||{};function A(e,t=""){const n=fe[e];return typeof n=="string"&&n.length>0?n:t}function j(e,t){const n=Number(fe[e]);return Number.isFinite(n)?n:t}const g={adsgram:{blockId:A("VITE_ADSGRAM_BLOCK_ID","REPLACE_ADSGRAM_BLOCK_ID"),sdkUrl:A("VITE_ADSGRAM_SDK_URL","https://sad.adsgram.ai/js/sad.min.js")},monetag:{scriptUrl:A("VITE_MONETAG_SCRIPT_URL","REPLACE_WITH_MONETAG_SCRIPT_URL"),showFunctionName:A("VITE_MONETAG_SHOW_FUNCTION","REPLACE_WITH_SHOW_FUNCTION"),defaultOptions:{type:A("VITE_MONETAG_TYPE","end"),requestVar:A("VITE_MONETAG_REQUEST_VAR","ad_reward_button"),timeout:j("VITE_MONETAG_TIMEOUT",15e3),catchIfNoFeed:String(A("VITE_MONETAG_CATCH_IF_NO_FEED","true")).toLowerCase()!=="false"}},richads:{scriptUrl:A("VITE_RICHADS_SCRIPT_URL","https://richinfo.co/richpartners/telegram/js/tg-ob.js"),pubId:A("VITE_RICHADS_PUB_ID","REPLACE_PUB_ID"),appId:A("VITE_RICHADS_APP_ID","REPLACE_APP_ID")},mybid:{apiBase:A("VITE_MYBID_API_BASE","https://publishers.mybid.io/backend/api/public"),token:A("VITE_MYBID_TOKEN","REPLACE_MYBID_TOKEN"),requestTimeoutMs:j("VITE_MYBID_TIMEOUT_MS",8e3)},tonConnect:{manifestUrl:A("VITE_TON_MANIFEST_URL","tonconnect-manifest.json"),buttonContainerId:A("VITE_TON_BUTTON_ID","ton-connect-button"),addressElementId:A("VITE_TON_ADDRESS_ID","ton-address"),recipientAddress:A("VITE_TON_RECIPIENT_ADDRESS","EQC-your-ton-address"),purchase:{amount:A("VITE_TON_PURCHASE_AMOUNT","2"),currency:A("VITE_TON_PURCHASE_CURRENCY","TON"),description:A("VITE_TON_PURCHASE_DESC","Gcoin top-up"),ttl:j("VITE_TON_PURCHASE_TTL",300),payloadHex:A("VITE_TON_PURCHASE_PAYLOAD_HEX","")},verifyManifest:String(A("VITE_TON_VERIFY_MANIFEST","true")).toLowerCase()!=="false"},rewards:{perAdUsd:j("VITE_REWARD_PER_AD_USD",.1)},rotationKey:A("VITE_AD_ROTATION_KEY","ad_rotation_pref"),monetagMaxConsecutive:j("VITE_MONETAG_MAX_CONSECUTIVE",5)};function Fe(e,t){return new Promise((n,o)=>{const a=setTimeout(()=>o(new Error("MyBid request timed out")),t);e.then(i=>{clearTimeout(a),n(i)}).catch(i=>{clearTimeout(a),o(i)})})}async function ee(e,t={}){var d,c,l;const n=((d=g.mybid)==null?void 0:d.apiBase)||"",o=((c=g.mybid)==null?void 0:c.token)||"";if(!n||!o)throw new Error("MyBid not configured");const a=new URL(e,n.endsWith("/")?n:n+"/");Object.entries(t).forEach(([p,f])=>{f!=null&&f!==""&&a.searchParams.set(p,String(f))}),a.searchParams.get("token")||a.searchParams.set("token",o);const i=fetch(a.toString(),{method:"GET",headers:{Accept:"application/json"},credentials:"omit"}),s=((l=g.mybid)==null?void 0:l.requestTimeoutMs)||8e3,r=await Fe(i,s);if(!r.ok){const p=await r.text().catch(()=>"");throw new Error(`MyBid HTTP ${r.status} ${r.statusText} ${p==null?void 0:p.slice(0,140)}`)}return r.json().catch(()=>({}))}const Ue={async stats({date1:e,date2:t,fields:n="date,impressions,clicks,money",orderBy:o="-date",limit:a=100,offset:i=0,filters:s=""}={}){return ee("stats",{date1:e,date2:t,fields:n,orderBy:o,limit:a,offset:i,filters:s})},async spots(){return ee("user-spots")},async health(){var i;const e=new Date,t=s=>s.toISOString().slice(0,10),n=t(e),o=new Date(e.getTime()-24*60*60*1e3),a=t(o);try{const s=await ee("stats",{date1:a,date2:n,fields:"date,impressions",orderBy:"-date",limit:1,offset:0});return Array.isArray((s==null?void 0:s.data)||s)?((i=s.data)==null?void 0:i.length)>0||s.length>0:!0}catch{return!1}}},G=new Map;function Z(e){return new Promise((t,n)=>{if(!e||String(e).startsWith("REPLACE_")||String(e).startsWith("REPLACE WITH"))return n(new Error("Script URL is not configured"));if(G.has(e)){const s=G.get(e);if(s==="loaded")return t();if(s&&s.then)return s.then(t).catch(n)}const o=document.querySelector(`script[src="${e}"]`);if(o)return o.dataset.loaded="true",G.set(e,"loaded"),t();const a=document.createElement("script");a.src=e,a.async=!0,a.referrerPolicy="no-referrer-when-downgrade",a.addEventListener("load",()=>{a.dataset.loaded="true",G.set(e,"loaded"),t()}),a.addEventListener("error",()=>{G.delete(e),n(new Error(`Failed to load script ${e}`))}),document.head.appendChild(a);const i=new Promise((s,r)=>{a.addEventListener("load",()=>s()),a.addEventListener("error",()=>r(new Error(`Failed to load script ${e}`)))});G.set(e,i)})}function De(){return typeof window<"u"&&window.Telegram&&window.Telegram.WebApp}function ge(){var e,t;return!!((e=g.monetag)!=null&&e.scriptUrl)&&!String(g.monetag.scriptUrl).startsWith("REPLACE_")&&!!((t=g.monetag)!=null&&t.showFunctionName)}async function $e(){var e;try{if(!ge())throw new Error("Monetag not configured");await Z(g.monetag.scriptUrl);const t=g.monetag.showFunctionName,n=t&&window[t];if(typeof n!="function")throw new Error(`Monetag show function ${t} is not available`);const o={...g.monetag.defaultOptions};if(De())try{const i=(e=window.Telegram.WebApp.initDataUnsafe)==null?void 0:e.user;i&&i.id&&(o.ymid=String(i.id))}catch{}return{ok:!0,provider:"monetag",payload:await n(o)}}catch(t){return{ok:!1,provider:"monetag",error:t}}}let K=null;function pe(){var e;return!!((e=g.adsgram)!=null&&e.blockId)&&!String(g.adsgram.blockId).startsWith("REPLACE_")}async function he(){if(!pe())return null;try{if(!window.Telegram&&!document.querySelector('script[src="https://telegram.org/js/telegram-web-app.js"]'))try{await Z("https://telegram.org/js/telegram-web-app.js")}catch{}if(window.Adsgram&&typeof window.Adsgram.init=="function"||await Z(g.adsgram.sdkUrl),!window.Adsgram||typeof window.Adsgram.init!="function")throw new Error("AdsGram SDK unavailable");return K=window.Adsgram.init({blockId:g.adsgram.blockId}),K}catch(e){return console.warn("[AdsGram] init failed:",(e==null?void 0:e.message)||e),null}}async function Ve(){try{if(K||await he(),!K||!K.show)throw new Error("AdsGram controller not available");return{ok:!0,provider:"adsgram",payload:await K.show()}}catch(e){return{ok:!1,provider:"adsgram",error:e}}}let D=null;function ye(){var e,t,n;return!!((e=g.richads)!=null&&e.scriptUrl)&&!String(g.richads.scriptUrl).startsWith("REPLACE_")&&!!((t=g.richads)!=null&&t.pubId)&&!String(g.richads.pubId).startsWith("REPLACE_")&&!!((n=g.richads)!=null&&n.appId)&&!String(g.richads.appId).startsWith("REPLACE_")}async function Ee(){if(!ye())return null;try{if(await Z(g.richads.scriptUrl),!window.TelegramAdsController)throw new Error("TelegramAdsController is not available");return D||(D=new window.TelegramAdsController,D.initialize({pubId:g.richads.pubId,appId:g.richads.appId})),D}catch(e){return console.warn("[RichAds] init failed:",(e==null?void 0:e.message)||e),null}}async function He(){try{if(D||await Ee(),!D)throw new Error("No RichAds controller");const e=["showRewarded","showInterstitial","show","run"];for(const t of e)if(typeof D[t]=="function")return{ok:!0,provider:"richads",payload:await Promise.resolve(D[t]())};throw new Error("No show method on RichAds controller")}catch(e){return{ok:!1,provider:"richads",error:e}}}function Ge(){var e,t;return!!((e=g.mybid)!=null&&e.apiBase)&&!!((t=g.mybid)!=null&&t.token)&&!String(g.mybid.token).startsWith("REPLACE_")}async function We(){if(!Ge())return!1;try{return!!await Ue.health()}catch{return!1}}let W=0;function Ke(){const e=Number(localStorage.getItem("adsgram_disabled_until")||0);return Number.isFinite(e)?e:0}function le(){return Ke()>Date.now()}function qe(e,t=""){try{const n=Date.now()+Math.max(0,e);localStorage.setItem("adsgram_disabled_until",String(n)),console.warn("[AdsGram] Temporarily disabled until",new Date(n).toISOString(),t||"")}catch{}}function Ye(){return ge()}function de(){return ye()}function ue(){return pe()}function je(){const e=g.rotationKey,t=localStorage.getItem(e);return t==="monetag"||t==="adsgram"?t:(localStorage.setItem(e,"monetag"),"monetag")}const we={async init(){ue()&&!le()&&he().catch(e=>console.warn("[AdsGram] preload failed:",(e==null?void 0:e.message)||e)),de()&&Ee().catch(e=>console.warn("[RichAds] preload failed:",(e==null?void 0:e.message)||e)),je();try{W=Number(localStorage.getItem("monetag_consecutive_count")||"0")||0}catch{W=0}},async showRewardedAd(){var s,r;const e=Ye(),t=de(),n=ue()&&!le();if(!e&&!t&&!n)return{ok:!1,error:{message:await We()?"No ad SDKs configured":"Ad backends unavailable"}};const o=e&&W<(g.monetagMaxConsecutive||5),a=[];o&&a.push("monetag"),t&&a.push("richads"),n&&a.push("adsgram"),!o&&e&&a.push("monetag");let i=null;for(const d of a){let c;if(d==="monetag"?c=await $e():d==="richads"?c=await He():c=await Ve(),c.ok){c.provider==="monetag"?W+=1:W=0;try{localStorage.setItem("monetag_consecutive_count",String(W))}catch{}return c}if(c.provider==="adsgram")try{const l=String(((s=c.error)==null?void 0:s.message)||c.error||"").toLowerCase();(l.includes("not active")||l.includes("moderation"))&&qe(6*60*60*1e3,"block inactive/moderation")}catch{}i=((r=c.error)==null?void 0:r.message)||String(c.error||"unknown error")}return{ok:!1,error:{message:i||"All providers failed"}}}},ze="https://raw.githubusercontent.com/ton-connect/sdk/main/assets/tonconnect-logo.png";function Xe(){try{const{origin:e,pathname:t}=window.location,n=t.endsWith("/")?t:t.substring(0,t.lastIndexOf("/")+1);return`${e}${n}`}catch{return null}}function Je(e){const t=e||"tonconnect-manifest.json",n=window.location.href.split("#")[0].split("?")[0],o=n.endsWith("/")?n:`${n.substring(0,n.lastIndexOf("/")+1)}`;try{return new URL(t,o).toString()}catch{try{return new URL(t,window.location.origin+"/").toString()}catch(i){throw new Error(`TonConnect invalid manifest URL: ${i.message}`)}}}async function Qe(e){const t=await fetch(e,{method:"GET",cache:"no-store",mode:"cors"});if(!t.ok){const a=await t.text().catch(()=>"");throw new Error(`HTTP ${t.status}. Body preview: ${a.slice(0,180)}`)}const n=await t.clone().text().catch(()=>null);let o=null;try{o=JSON.parse(n||"{}")}catch{o=null}return{manifestJson:o,manifestText:n}}function Ze(e){if(!e||typeof e!="object")return{manifest:null,changed:!1};const t={...e};let n=!1;const o=Xe();!t.url&&o&&(t.url=o,n=!0),t.name||(t.name=(g==null?void 0:g.appName)||document.title||"TonConnect App",n=!0);const a=typeof t.iconUrl=="string"?t.iconUrl:"";return(!a||a.endsWith(".svg")||a.startsWith("data:image/svg"))&&(t.iconUrl=ze,n=!0),{manifest:t,changed:n}}function te(...e){}function z(...e){console.error("[TonConnect]",...e)}let R=null,J=null;const et=new Set;function ne(e){const t=e&&e.account?e.account:e;re(t),et.forEach(n=>{try{n(t||null)}catch(o){console.warn("[TonConnect] subscriber error",o)}});try{window.dispatchEvent(new CustomEvent("ton-status",{detail:t||null}))}catch{}}function re(e){var n;const t=document.getElementById(((n=g.tonConnect)==null?void 0:n.addressElementId)||"ton-address");if(t)if(e!=null&&e.address){const o=`${e.address.slice(0,6)}...${e.address.slice(-4)}`;t.textContent=o,t.dataset.full=e.address,t.classList.add("connected")}else t.textContent="Не подключено",t.dataset.full="",t.classList.remove("connected")}function tt(){var t;const e=document.getElementById(((t=g.tonConnect)==null?void 0:t.addressElementId)||"ton-address");e&&(e.style.cursor="pointer",e.addEventListener("click",async()=>{const n=e.dataset.full||"";if(n)try{await navigator.clipboard.writeText(n);const o=e.textContent;e.textContent="Copied!",setTimeout(()=>re((R==null?void 0:R.account)||null)||(e.textContent=o),1e3)}catch(o){console.warn("[TonConnect] clipboard copy failed",o)}}))}async function nt(){var s,r,d,c;const e=((s=g.tonConnect)==null?void 0:s.buttonContainerId)||"ton-connect-button",t=Je((r=g.tonConnect)==null?void 0:r.manifestUrl);let n=null;((d=g.tonConnect)==null?void 0:d.verifyManifest)!==!1&&(n=await Qe(t));let o=t;const{manifest:a,changed:i}=Ze((n==null?void 0:n.manifestJson)||null);try{R=new ce({manifestUrl:o,buttonRootId:e,language:"ru"}),te("TonConnectUI instance created. Version:",((c=ce)==null?void 0:c.version)||"unknown")}catch(l){throw z("Failed to create TonConnectUI instance:",l,l==null?void 0:l.stack),l}tt(),re(R.account),R.onStatusChange(l=>{te("Status change → wallet",l?l.account:"null"),ne(l)},l=>{z("Status change error:",l),ne(null)});try{const l=await R.connectionRestored;te("connectionRestored resolved →",l),l&&ne(R.account)}catch(l){z("Connection restoration failed:",l)}return R}function be(){return J||(J=nt().catch(e=>(z("init failed:",(e==null?void 0:e.message)||e),R=null,J=null,null))),J}function at(){return R}async function ot(){const e=await be();return e||z("ensureTonConnectReady → TonConnectUI unavailable"),e}function it(){var e;R&&((e=R.openModal)==null||e.call(R))}function st(e){const t=Number(e||0);return!Number.isFinite(t)||t<=0?null:BigInt(Math.round(t*1e9)).toString()}async function rt(){var s,r,d,c,l,p,f,v,I;const e=at()||await ot();if(!e){alert("TonConnect UI не инициализирован. Проверьте manifestUrl.");return}if(!e.account){it(),alert("Подключите TON-кошелёк, чтобы продолжить.");return}const t=localStorage.getItem("ton_recipient")||((s=g.tonConnect)==null?void 0:s.recipientAddress),n=st((d=(r=g.tonConnect)==null?void 0:r.purchase)==null?void 0:d.amount);if(!t||!n){alert("Параметры TON-покупки не настроены.");return}const o={address:t,amount:n},a=(l=(c=g.tonConnect)==null?void 0:c.purchase)==null?void 0:l.payloadHex;a&&(o.payload=a);const i={validUntil:Math.round(Date.now()/1e3)+(((f=(p=g.tonConnect)==null?void 0:p.purchase)==null?void 0:f.ttl)||300),messages:[o]};try{await e.sendTransaction(i);const b=((I=(v=g.tonConnect)==null?void 0:v.purchase)==null?void 0:I.successMessage)||"Платёж в TON отправлен! После подтверждения пополните баланс вручную.";alert(b)}catch(b){console.warn("[TON Purchase] sendTransaction failed",b);const T=(b==null?void 0:b.message)||"Не удалось отправить транзакцию TON.";alert(T)}}function ct(){const e=document.getElementById("exchange-modal"),t=document.getElementById("exchange-btn"),n=document.getElementById("close-exchange-btn"),o=document.getElementById("confirm-exchange-btn"),a=document.getElementById("ad-reward-btn"),i=document.getElementById("buy-ton-btn"),s=document.getElementById("from-amount"),r=document.getElementById("from-currency"),d=document.getElementById("to-amount"),c=document.getElementById("to-currency"),l=200;t&&t.addEventListener("click",()=>{e&&(e.style.display="flex")}),n&&n.addEventListener("click",()=>{e&&(e.style.display="none")});const p=()=>{const f=parseFloat((s==null?void 0:s.value)||"0")||0,v=(r==null?void 0:r.value)||"real_balance";let I=0;v==="real_balance"?(c&&(c.value="gcoin"),I=f*l):(c&&(c.value="real_balance"),I=f/l),d&&(d.value=I.toFixed(2))};if(s&&s.addEventListener("input",p),r&&r.addEventListener("change",p),o&&o.addEventListener("click",()=>{const f=parseFloat((s==null?void 0:s.value)||"0")||0,v=(r==null?void 0:r.value)||"real_balance",I=(c==null?void 0:c.value)||"gcoin",b=parseFloat((d==null?void 0:d.value)||"0")||0;if(f<=0){alert("Введите корректную сумму / Please enter a valid amount.");return}if(U.getBalance(v)<f){alert("Недостаточно средств для обмена / Insufficient funds for this exchange.");return}U.subtract(f,v),U.add(b,I),alert("Обмен выполнен! / Exchange successful!"),e&&(e.style.display="none"),s&&(s.value=""),d&&(d.value="")}),a){const f=a.innerHTML;a.addEventListener("click",async()=>{try{a.disabled=!0,a.innerHTML="Поиск рекламы… / Searching for ad…";const v=await we.showRewardedAd();if(v&&v.ok){const I=v.provider,b=v.payload||{};let T=!1;if(I==="monetag"?T=b&&b.reward_event_type==="valued":I==="adsgram"?T=!!b&&b.done===!0:I==="richads"&&(T=!0),T){const h=Number(g.rewards.perAdUsd||.1);U.add(h,"real_balance"),alert(`Реклама (${I}) просмотрена! Начислено $${h.toFixed(2)}.
Ad viewed successfully! Provider: ${I}. You've earned $${h.toFixed(2)}.`)}else alert(`Реклама не была досмотрена до конца или не засчитана. Награда не начислена.
Ad was not completed or not eligible.`)}else alert(`Ошибка рекламы, попробуйте позже.
Ad error, please try again later.`)}catch(v){console.warn("Ad error:",v),alert(`Ошибка рекламы, попробуйте позже.
Ad error, please try again later.`)}finally{a.disabled=!1,a.innerHTML=f}})}i&&i.addEventListener("click",()=>{rt()})}window.addEventListener("DOMContentLoaded",()=>{try{window.Telegram&&window.Telegram.WebApp&&typeof window.Telegram.WebApp.ready=="function"&&window.Telegram.WebApp.ready()}catch{}U.init(),Ce.init(),Oe(),we.init(),ct(),be(),console.log("App initialized.")});
