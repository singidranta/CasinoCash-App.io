import{T as ae}from"./vendor-4QxL1Nz2.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const O={balances:{gcoin:0,real_balance:0},storageKey:"app_wallet",init(){try{const e=localStorage.getItem(this.storageKey);e?this.balances=JSON.parse(e):(this.balances.gcoin=1e3,this.balances.real_balance=5,this.save())}catch(e){console.error("Failed to load wallet from storage",e)}this.updateDisplay()},getBalance(e="gcoin"){return this.balances[e]},updateBalance(e,t){Object.prototype.hasOwnProperty.call(this.balances,e)?(this.balances[e]=t,this.save(),this.updateDisplay()):console.error(`Currency ${e} not found.`)},add(e,t="gcoin"){Object.prototype.hasOwnProperty.call(this.balances,t)&&(this.balances[t]+=e,this.save(),this.updateDisplay())},subtract(e,t="gcoin"){return Object.prototype.hasOwnProperty.call(this.balances,t)&&this.balances[t]>=e?(this.balances[t]-=e,this.save(),this.updateDisplay(),!0):!1},save(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.balances))}catch(e){console.error("Failed to save wallet to storage",e)}},updateDisplay(){const e=document.getElementById("gcoin-balance");if(e)try{e.textContent=this.balances.gcoin.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}catch{e.textContent=String(this.balances.gcoin)}const t=document.getElementById("real-balance-amount");if(t)try{t.textContent=this.balances.real_balance.toLocaleString("en-US",{style:"currency",currency:"USD"})}catch{t.textContent=`$${Number(this.balances.real_balance).toFixed(2)}`}const n=document.getElementById("game-balance-amount");if(n)try{n.textContent=this.balances.gcoin.toLocaleString("en-US")}catch{n.textContent=String(this.balances.gcoin)}}},fe={storageKey:"gcoin_settings",config:{sound:!0,backgroundAnimation:!0,soundVolume:45},init(){try{const e=localStorage.getItem(this.storageKey);e&&(this.config=JSON.parse(e))}catch(e){console.error("Failed to load settings from storage",e)}this.applyToUI(),this.listenForChanges()},save(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.config)),console.log("Settings saved:",this.config)}catch(e){console.error("Failed to save settings to storage",e)}},applyToUI(){const e=document.getElementById("sound-toggle"),t=document.getElementById("bg-animation-toggle"),n=document.getElementById("sound-volume");e&&(e.checked=this.config.sound),t&&(t.checked=this.config.backgroundAnimation),n&&(n.value=this.config.soundVolume)},listenForChanges(){const e=document.getElementById("sound-toggle"),t=document.getElementById("bg-animation-toggle"),n=document.getElementById("sound-volume");e&&e.addEventListener("change",o=>{this.config.sound=o.target.checked,this.save()}),t&&t.addEventListener("change",o=>{this.config.backgroundAnimation=o.target.checked,this.save()}),n&&n.addEventListener("input",o=>{this.config.soundVolume=Number(o.target.value),this.save()})}},Q={lottery:{key:"lottery",name:"Scratch Lottery",description:"Выберите билет (Bronze/Silver/Gold), купите и сотрите поле монеткой, чтобы узнать выигрыш.",type:"lottery",minBet:10,maxBet:250,defaultBet:25,winChance:.2,winMultiplier:5},coinflip:{key:"coinflip",name:"Coin Flip",description:"Выберите сторону и удвойте ставку при верном угадывании.",type:"coinflip",minBet:10,maxBet:300,defaultBet:20,options:["Орёл","Решка"]},crash:{key:"crash",name:"Crash",description:"Следите за ракетой и выводите до взрыва. Настройте автостоп.",type:"crash",minBet:5,maxBet:500,defaultBet:30,multipliers:[1.5,2,3,5],maxAutoStop:10}};function q(e,t){const n=Q[e];if(!n)return 0;const o=Number.isFinite(t)?t:n.defaultBet;return Math.min(Math.max(o,n.minBet),n.maxBet)}function ge(e){return Q[e]||null}function Z(e,t){const n=Q[e];if(!n)return!1;const o=q(e,t??n.defaultBet);return O.getBalance("gcoin")>=o}function ee(e,t){const n=q(e,t);if(!O.subtract(n,"gcoin"))throw new Error("Недостаточно gcoin для ставки");return n}function te(e){e>0&&O.add(e,"gcoin")}function pe(e,t){const n=q("coinflip",t),o=Math.random()<.5?"Орёл":"Решка",a=e===o,s=a?n*2:0;return te(s),{win:a,bet:n,reward:s,result:o,message:a?`Вы угадали! Баланс пополнен на ${s.toFixed(2)} gcoin.`:`Выпало "${o}". Ставка проиграна.`}}function he({autoStopMultiplier:e=2,volatility:t=3.2}){const n=1+Math.random()*t,o=[];let a=1;for(;a<n&&(a+=Math.random()*.28+.05,o.push(Number(a.toFixed(2))),!(o.length>100)););const s=e<n;return{crashPoint:Number(n.toFixed(2)),path:o,survived:s}}function ye(e,t){const n=q("crash",e),o=Math.max(1.1,t),{crashPoint:a,path:s,survived:l}=he({autoStopMultiplier:o});let r=0;return l&&(r=Number((n*o).toFixed(2)),te(r)),{win:l,bet:n,reward:r,crashPoint:a,autoStop:o,path:s,message:l?`Ракета достигла x${o.toFixed(2)} до взрыва! Профит ${r.toFixed(2)} gcoin.`:`Краш на x${a.toFixed(2)}. Вы не успели вывести.`}}function ve(e,t={}){if(!e)throw new Error("ScratchEngine: hostEl is required");const n={radius:Math.max(6,t.radius||16),cover:t.cover||"#B7BEC5",opacity:t.opacity??.95,progressSampleEvery:t.progressSampleEvery||8,revealFadeMs:t.revealFadeMs||240},o=e.style.position;getComputedStyle(e).position==="static"&&(e.style.position="relative");const a=document.createElement("canvas");a.className="scratch-canvas",a.style.position="absolute",a.style.inset="0",a.style.touchAction="none",a.style.userSelect="none",e.appendChild(a);const s=a.getContext("2d",{willReadFrequently:!0}),l=Math.min(2,window.devicePixelRatio||1);let r=0,i=0;function m(){const y=e.getBoundingClientRect();r=Math.max(1,Math.floor(y.width)),i=Math.max(1,Math.floor(y.height)),a.width=Math.floor(r*l),a.height=Math.floor(i*l),a.style.width=r+"px",a.style.height=i+"px",s.setTransform(l,0,0,l,0,0),h()}function h(){s.globalCompositeOperation="source-over",s.clearRect(0,0,r,i),s.globalAlpha=n.opacity,s.fillStyle=n.cover,s.fillRect(0,0,r,i);const y=s.createLinearGradient(0,0,r,i);y.addColorStop(0,"rgba(255,255,255,0.14)"),y.addColorStop(1,"rgba(0,0,0,0.12)"),s.globalAlpha=.18,s.fillStyle=y,s.fillRect(0,0,r,i),s.globalAlpha=1,s.globalCompositeOperation="destination-out"}let b=!1,w=0,C=0,S=0,x=!1;const L=new Set;function v(){const y=u();L.forEach(k=>{try{k(y)}catch{}})}function N(y){b=!0;const{x:k,y:A}=g(y);w=k,C=A,d(k,A),S=0}function M(y){if(!b)return;const{x:k,y:A}=g(y);c(w,C,k,A),w=k,C=A,++S%n.progressSampleEvery===0&&v()}function F(){b&&(b=!1,v())}function g(y){const k=a.getBoundingClientRect(),A=(y.touches?y.touches[0].clientX:y.clientX)??0,U=(y.touches?y.touches[0].clientY:y.clientY)??0;return{x:A-k.left,y:U-k.top}}function d(y,k){s.beginPath(),s.arc(y,k,n.radius,0,Math.PI*2),s.fill()}function c(y,k,A,U){const _=A-y,P=U-k,V=Math.hypot(_,P),de=Math.max(1,n.radius*.6),ue=_/V,me=P/V;for(let K=0;K<=V;K+=de)d(y+ue*K,k+me*K)}function u(){try{const y=Math.max(1,Math.floor(r*l)),k=Math.max(1,Math.floor(i*l)),{data:A}=s.getImageData(0,0,y,k);let U=0;for(let P=3;P<A.length;P+=4)A[P]<16&&U++;const _=y*k;return _?U/_:0}catch{return 0}}function f(y){return typeof y=="function"&&L.add(y),()=>L.delete(y)}function p(){x||(x=!0,a.style.transition=`opacity ${n.revealFadeMs}ms ease`,a.style.opacity="0",setTimeout(()=>{a.remove()},n.revealFadeMs+20),T())}function E(){x=!1,a.style.opacity="1",a.isConnected||e.appendChild(a),h()}function T(){a.removeEventListener("pointerdown",N),window.removeEventListener("pointermove",M),window.removeEventListener("pointerup",F),window.removeEventListener("resize",m)}function H(){T(),a.isConnected&&a.remove(),o&&(e.style.position=o),L.clear()}return a.addEventListener("pointerdown",N),window.addEventListener("pointermove",M,{passive:!0}),window.addEventListener("pointerup",F),window.addEventListener("resize",m),m(),{onProgress:f,getProgressRatio:u,reveal:p,reset:E,destroy:H,canvas:a}}function we(e){const t="lottery",n=[{id:"bronze",name:"Bronze",color:"#CD7F32",winChance:.18,multiplier:3},{id:"silver",name:"Silver",color:"#C0C0C0",winChance:.22,multiplier:5},{id:"gold",name:"Gold",color:"#D4AF37",winChance:.25,multiplier:8}];let o=e.info.defaultBet,a=n[1],s=null,l=null,r=null,i=null,m=!1,h=null;function b(g){const d=e.info,c=Number(g);Number.isFinite(c)?o=Math.min(Math.max(c,d.minBet),d.maxBet):o=d.defaultBet,e.setStakeInfo(o)}function w(){const g=document.createElement("div");g.className="game-control-group";const d=document.createElement("label");d.textContent="Размер ставки";const c=document.createElement("input");c.type="range",c.min=String(e.info.minBet),c.max=String(e.info.maxBet),c.step="1",c.value=String(o),c.className="stake-slider";const u=document.createElement("input");return u.type="number",u.min=String(e.info.minBet),u.max=String(e.info.maxBet),u.step="1",u.value=String(o),u.className="stake-input",c.addEventListener("input",f=>{u.value=f.target.value,b(f.target.value)}),u.addEventListener("change",f=>{b(f.target.value),c.value=String(o),u.value=String(o)}),g.appendChild(d),g.appendChild(c),g.appendChild(u),g}function C(){const g=document.createElement("div");return g.className="variants-row",n.forEach(d=>{const c=document.createElement("button");c.type="button",c.className="variant-card",c.dataset.id=d.id,c.style.setProperty("--variant-color",d.color),c.innerHTML=`
        <span class="variant-dot" style="background:${d.color}"></span>
        <span class="variant-name">${d.name}</span>
        <span class="variant-odds">${Math.round(d.winChance*100)}% · x${d.multiplier}</span>
      `,d.id===a.id&&c.classList.add("active"),c.addEventListener("click",()=>{a=d,e.setMultiplierInfo(a.multiplier,!0);for(const u of g.querySelectorAll(".variant-card"))u.classList.remove("active");c.classList.add("active"),S()}),g.appendChild(c)}),g}function S(){if(!l)return;l.innerHTML="",r=document.createElement("div"),r.className=`ticket-card variant-${a.id}`,r.style.setProperty("--variant-color",a.color);const g=document.createElement("div");g.className="ticket-header",g.innerHTML=`
      <div class="ticket-title">
        <span class="ticket-name">${a.name} Ticket</span>
        <span class="ticket-multiplier">x${a.multiplier}</span>
      </div>
      <div class="ticket-hint">Сотри серое поле монеткой</div>
    `;const d=document.createElement("div");d.className="ticket-body";const c=document.createElement("div");c.className="ticket-result",c.innerHTML='<div class="result-placeholder">Купите билет, чтобы стереть</div>',d.appendChild(c),r.appendChild(g),r.appendChild(d),l.appendChild(r)}function x(){if(!r)return;i&&(i.destroy(),i=null);const g=r.querySelector(".ticket-body");i=ve(g,{radius:18,cover:"#C1C7CE",opacity:.94}),i.onProgress(d=>{!m&&d>.6&&(m=!0,i.reveal(),L())})}function L(){h&&(h.reward>0&&te(h.reward),e.setStatus(h.message,h.win?"win":"lose"),s&&(s.disabled=!1,s.textContent="Купить ещё"))}function v(){if(!Z(t,o)){e.setStatus("Недостаточно gcoin для покупки билета.","lose");return}const g=ee(t,o),d=Math.random()<a.winChance,c=d?g*a.multiplier:0;h={win:d,bet:g,reward:c,multiplier:a.multiplier,message:d?`Повезло! Выигрыш ${c.toFixed(2)} gcoin (x${a.multiplier}).`:"Увы, без выигрыша. Попробуйте другой билет!"};const u=r.querySelector(".ticket-result");u.innerHTML=d?`<div class="result-win">ДЖЕКПОТ!<br><span class="amount">+${c.toFixed(2)} gcoin</span></div>`:'<div class="result-lose">Не выиграл</div>',m=!1,x(),e.setStatus("Стирайте монеткой серое поле, чтобы узнать результат…",""),s&&(s.disabled=!0,s.textContent="Стирайте…")}function N(){const g=document.createElement("div");return g.className="game-controls-row",s=document.createElement("button"),s.type="button",s.className="btn btn-primary",s.textContent="Купить билет",s.addEventListener("click",v),g.appendChild(s),g}function M(){e.configEl.appendChild(w()),e.configEl.appendChild(C()),l=document.createElement("div"),l.className="scratch-stage",e.stageEl.appendChild(l),S(),e.controlsEl.appendChild(N()),e.setMultiplierInfo(a.multiplier,!0),e.setStatus("Выберите билет, настройте ставку и купите билет.","")}function F(){i&&(i.destroy(),i=null),s=null,l=null,r=null,h=null,m=!1}return b(o),{mount:M,destroy:F}}function be(e){var g;const t="coinflip",n=e.info;let o=n.defaultBet,a=((g=n.options)==null?void 0:g[0])||"Орёл",s=!1,l=null,r=null,i=null;const m=()=>{l&&(clearTimeout(l),l=null)},h=d=>{o=Number(d),Number.isFinite(o)||(o=n.defaultBet),o=Math.min(Math.max(o,n.minBet),n.maxBet),e.setStakeInfo(o)},b=d=>{a=d,e.setStatus(`Вы выбрали ${d}.`,"")},w=d=>d==="Решка"?"tails":"heads",C=()=>{const d=document.createElement("div");d.className="game-control-group";const c=document.createElement("label");c.textContent="Размер ставки";const u=document.createElement("input");u.type="range",u.min=String(n.minBet),u.max=String(n.maxBet),u.step="1",u.value=String(o),u.className="stake-slider";const f=document.createElement("input");return f.type="number",f.min=String(n.minBet),f.max=String(n.maxBet),f.step="1",f.value=String(o),f.className="stake-input",u.addEventListener("input",p=>{f.value=p.target.value,h(p.target.value)}),f.addEventListener("change",p=>{const E=Number(p.target.value);h(E),u.value=String(o),f.value=String(o)}),d.appendChild(c),d.appendChild(u),d.appendChild(f),d},S=()=>{var f;const d=document.createElement("div");d.className="game-control-group";const c=document.createElement("label");c.textContent="Сторона монеты",d.appendChild(c);const u=document.createElement("div");return u.className="coin-choice-row",(f=n.options)==null||f.forEach(p=>{const E=document.createElement("button");E.type="button",E.className="btn btn-secondary btn-choice",E.textContent=p,p===a&&E.classList.add("active"),E.addEventListener("click",()=>{u.querySelectorAll(".btn-choice").forEach(T=>T.classList.remove("active")),E.classList.add("active"),b(p)}),u.appendChild(E)}),d.appendChild(u),d},x=()=>{const d=document.createElement("div");d.className="coin-stage";const c=document.createElement("div");c.className="coin",c.dataset.side=w(a);const u=document.createElement("div");u.className="coin-face coin-front",u.textContent="Орёл";const f=document.createElement("div");return f.className="coin-face coin-back",f.textContent="Решка",c.appendChild(u),c.appendChild(f),d.appendChild(c),r=c,d},L=(d,c)=>{if(!r)return;r.classList.remove("coin-win","coin-lose"),r.classList.add("coin-flip");const u=c.win;l=setTimeout(()=>{r.classList.remove("coin-flip"),r.style.transform=d==="Решка"?"rotateY(180deg)":"rotateY(0deg)",r.dataset.side=w(d),r.classList.add(u?"coin-win":"coin-lose"),e.setStatus(c.message,u?"win":"lose"),s=!1,i&&(i.disabled=!1,i.textContent="Бросить монету")},1500)},v=()=>{if(s)return;if(!Z(t,o)){e.setStatus("Недостаточно gcoin для ставки.","lose");return}const d=ee(t,o),c=pe(a,d);e.setStatus("Монета в полёте...",""),s=!0,i&&(i.disabled=!0,i.textContent="Бросаем..."),m(),L(c.result,c)},N=()=>{const d=document.createElement("div");return d.className="game-controls-row",i=document.createElement("button"),i.type="button",i.className="btn btn-primary",i.textContent="Бросить монету",i.addEventListener("click",v),d.appendChild(i),d},M=()=>{e.configEl.appendChild(C()),e.configEl.appendChild(S()),e.stageEl.appendChild(x()),e.controlsEl.appendChild(N()),e.setStatus("Выберите сторону и сделайте ставку.",""),e.setMultiplierInfo(1,!1)},F=()=>{m(),r=null,i=null,s=!1};return h(o),b(a),{mount:M,destroy:F}}function Ce(e){var d;const t="crash",n=e.info;let o=n.defaultBet,a=((d=n.multipliers)==null?void 0:d[1])||2,s=!1,l=null,r=null,i=null,m=null,h=null;const b=c=>{o=Number(c),Number.isFinite(o)||(o=n.defaultBet),o=Math.min(Math.max(o,n.minBet),n.maxBet),e.setStakeInfo(o)},w=c=>{var u;a=Number(c),Number.isFinite(a)||(a=((u=n.multipliers)==null?void 0:u[0])||1.5),a=Math.min(Math.max(a,1.1),n.maxAutoStop||10),e.setMultiplierInfo(a,!0)},C=()=>{const c=document.createElement("div");c.className="game-control-group";const u=document.createElement("label");u.textContent="Размер ставки";const f=document.createElement("input");f.type="range",f.min=String(n.minBet),f.max=String(n.maxBet),f.step="1",f.value=String(o),f.className="stake-slider";const p=document.createElement("input");return p.type="number",p.min=String(n.minBet),p.max=String(n.maxBet),p.step="1",p.value=String(o),p.className="stake-input",f.addEventListener("input",E=>{p.value=E.target.value,b(E.target.value)}),p.addEventListener("change",E=>{const T=Number(E.target.value);b(T),f.value=String(o),p.value=String(o)}),c.appendChild(u),c.appendChild(f),c.appendChild(p),c},S=()=>{const c=document.createElement("div");c.className="game-control-group";const u=document.createElement("label");u.textContent="Автостоп (множитель)";const f=document.createElement("input");f.type="range",f.min="1.1",f.max=String(n.maxAutoStop||10),f.step="0.1",f.value=String(a),f.className="stake-slider";const p=document.createElement("input");return p.type="number",p.min="1.1",p.max=String(n.maxAutoStop||10),p.step="0.1",p.value=String(a),p.className="stake-input",f.addEventListener("input",E=>{p.value=E.target.value,w(E.target.value)}),p.addEventListener("change",E=>{const T=Number(E.target.value);w(T),f.value=String(a),p.value=String(a)}),c.appendChild(u),c.appendChild(f),c.appendChild(p),c},x=()=>{const c=document.createElement("div");c.className="crash-stage";const u=document.createElement("canvas");return u.width=360,u.height=200,u.className="crash-canvas",c.appendChild(u),r=u,i=u.getContext("2d"),L(),c},L=()=>{!i||!r||(i.clearRect(0,0,r.width,r.height),i.fillStyle="rgba(18, 16, 42, 0.75)",i.fillRect(0,0,r.width,r.height),i.strokeStyle="rgba(125, 120, 255, 0.28)",i.lineWidth=1,i.setLineDash([4,6]),i.beginPath(),i.moveTo(0,r.height-40),i.lineTo(r.width,40),i.stroke(),i.setLineDash([]),i.fillStyle="rgba(143, 150, 199, 0.8)",i.font="12px Manrope",i.fillText("x1",6,r.height-10),i.fillText("x2",80,r.height-80),i.fillText("x5",160,r.height-140),i.fillText("x10",r.width-36,60))},v=(c,u,f)=>{if(!i||!r)return;cancelAnimationFrame(l),L(),i.strokeStyle=f?"rgba(95, 255, 211, 0.85)":"rgba(255, 92, 154, 0.85)",i.lineWidth=3,i.beginPath();const p=Math.max(u,a,...c,1.5),E=(r.height-40)/Math.max(p,1.2),T=(r.width-40)/c.length;c.forEach((A,U)=>{const _=20+T*U,P=r.height-A*E;U===0?i.moveTo(_,P):i.lineTo(_,P)}),i.stroke(),i.fillStyle=f?"rgba(95, 255, 211, 0.9)":"rgba(255, 92, 154, 0.9)",i.beginPath();const H=c[c.length-1]||1,y=20+T*(c.length-1),k=r.height-H*E;i.arc(y,k,6,0,Math.PI*2),i.fill(),i.fillStyle="rgba(143, 150, 199, 0.85)",i.font="13px Manrope",i.textAlign="right",i.fillText(`Краш: x${u.toFixed(2)}`,r.width-12,24),i.fillText(`Автостоп: x${a.toFixed(2)}`,r.width-12,42),i.textAlign="left"},N=()=>{if(s)return;if(!Z(t,o)){e.setStatus("Недостаточно gcoin для ставки.","lose");return}const c=ee(t,o);s=!0,e.setStatus("Ракета взлетает...",""),m&&(m.disabled=!0),h&&(h.disabled=!0);const u=ye(c,a);e.setStatus(u.message,u.win?"win":"lose"),L();let f=0;const p=()=>{const E=u.path.slice(0,Math.min(f,u.path.length));v(E,u.crashPoint,u.win),f+=1,f<=u.path.length?l=requestAnimationFrame(p):(s=!1,m&&(m.disabled=!1),h&&(h.disabled=!1))};l=requestAnimationFrame(p)},M=()=>{const c=document.createElement("div");return c.className="game-controls-row",m=document.createElement("button"),m.type="button",m.className="btn btn-primary",m.textContent="Старт",m.addEventListener("click",N),h=document.createElement("button"),h.type="button",h.className="btn btn-secondary",h.textContent="Очистить график",h.addEventListener("click",()=>{L(),e.setStatus("График очищен. Настройте автостоп и ставку.","")}),c.appendChild(m),c.appendChild(h),c},F=()=>{e.configEl.appendChild(C()),e.configEl.appendChild(S()),e.stageEl.appendChild(x()),e.controlsEl.appendChild(M()),e.setStatus("Настройте ставку и автостоп, затем запускайте раунд.","")},g=()=>{cancelAnimationFrame(l),l=null,r=null,i=null,m=null,h=null,s=!1};return b(o),w(a),{mount:F,destroy:g}}const Ee={lottery:we,coinflip:be,crash:Ce};function xe({titleEl:e,descriptionEl:t,configEl:n,stageEl:o,controlsEl:a,statusEl:s,stakeInfoEl:l,multiplierInfoEl:r}){const i={activeKey:null,activeInstance:null},m=v=>{v&&(v.innerHTML="")},h=(v="",N="")=>{s&&(s.textContent=v,s.classList.remove("game-result-win","game-result-lose"),N==="win"?s.classList.add("game-result-win"):N==="lose"&&s.classList.add("game-result-lose"))},b=v=>{l&&(typeof v=="number"?l.textContent=`Ставка: ${v.toFixed(2)} gcoin`:l.textContent=v||"Ставка: —")},w=(v,N=!0)=>{if(r){if(!N){r.style.display="none";return}r.style.display="",r.textContent=`Множитель: x${Number(v||1).toFixed(2)}`}},C=()=>{if(h("Выберите игру, чтобы начать раунд.",""),b("Ставка: —"),w(1,!1),m(n),m(o),m(a),o){const v=document.createElement("div");v.className="game-placeholder",v.textContent="Выберите игру из главного зала",o.appendChild(v)}},S=()=>{i.activeInstance&&typeof i.activeInstance.destroy=="function"&&i.activeInstance.destroy(),i.activeInstance=null,i.activeKey=null},x=v=>{var d;const N=Ee[v],M=ge(v);if(!N||!M){console.warn("[GameManager] Unknown game key:",v);return}if(S(),m(n),m(o),m(a),h("Настройте параметры и нажмите старт.",""),typeof M.defaultBet=="number"?b(M.defaultBet):typeof M.minBet=="number"?b(M.minBet):b("Ставка: —"),M.type==="crash"){const c=((d=M.multipliers)==null?void 0:d[0])||1.5;w(c,!0)}else w(1,!1);e&&(e.textContent=M.name),t&&(t.textContent=M.description);const g=N({configEl:n,stageEl:o,controlsEl:a,setStatus:h,setStakeInfo:b,setMultiplierInfo:w,info:M});g&&typeof g.mount=="function"?(g.mount(),i.activeInstance=g,i.activeKey=v):(console.warn("[GameManager] Invalid game instance for key:",v),C())},L=()=>{S(),e&&(e.textContent="Выберите игру"),t&&(t.textContent="Откройте игру из каталога, чтобы начать."),C()};return L(),{openGame:x,reset:L,hasActiveGame:()=>!!i.activeKey,getActiveGameKey:()=>i.activeKey}}function Se(e){const t={home:document.getElementById("home-view"),game:document.getElementById("game-view"),wallet:document.getElementById("wallet-view")},n=document.querySelectorAll(".nav-item"),o=()=>{Object.values(t).forEach(l=>{l&&(l.style.display="none")})},a=l=>{n.forEach(r=>{r.classList.toggle("active",r.dataset.view===l)})},s=l=>{o();const r=t[l]||t.home;r&&(r.style.display="flex")};return n.forEach(l=>{const r=l.dataset.view||"home";l.addEventListener("click",i=>{i.preventDefault(),s(r),a(r),r==="home"&&e.reset()})}),s("home"),a("home"),{switchView:s,updateNavActive:a}}function Be(){const e=document.getElementById("settings-modal"),t=document.querySelector(".settings-btn"),n=document.getElementById("close-settings-btn");t&&t.addEventListener("click",()=>{e&&(e.style.display="flex")}),n&&n.addEventListener("click",()=>{e&&(e.style.display="none")}),e&&e.addEventListener("click",o=>{o.target===e&&(e.style.display="none")})}function Le(){return xe({titleEl:document.getElementById("active-game-title"),descriptionEl:document.getElementById("active-game-description"),configEl:document.getElementById("game-config"),stageEl:document.getElementById("game-stage"),controlsEl:document.getElementById("game-controls"),statusEl:document.getElementById("game-status"),stakeInfoEl:document.getElementById("game-stake-info"),multiplierInfoEl:document.getElementById("game-multiplier-info")})}function ke(e,t){document.querySelectorAll(".game-card").forEach(o=>{o.addEventListener("click",()=>{const a=o.dataset.game;a&&(t.switchView("game"),t.updateNavActive("game"),e.openGame(a))})})}function Me(e,t){const n=document.getElementById("back-to-library");n&&n.addEventListener("click",()=>{e.reset(),t.switchView("home"),t.updateNavActive("home")})}function Ne(){const e=Le(),t=Se(e);Be(),ke(e,t),Me(e,t)}const B={adsgram:{blockId:"15234",sdkUrl:"https://sad.adsgram.ai/js/sad.min.js"},monetag:{scriptUrl:"https://libtl.com/sdk.js",showFunctionName:"show_9922551",defaultOptions:{type:"end",requestVar:"ad_reward_button",timeout:15e3,catchIfNoFeed:!0}},tonConnect:{manifestUrl:"https://singidranta.github.io/CasinoCash-App.io/tonconnect-manifest.json",buttonContainerId:"ton-connect-button",addressElementId:"ton-address",recipientAddress:"EQC-your-ton-address",purchase:{amount:"2",currency:"TON",description:"Gcoin top-up"}},rewards:{perAdUsd:.1},rotationKey:"ad_next_provider"},G=new Map;let D=null;function Ae(){return typeof window<"u"&&window.Telegram&&window.Telegram.WebApp}function Ie(){return!String(B.monetag.scriptUrl).startsWith("REPLACE_")&&!0}function j(){return!String(B.adsgram.blockId).startsWith("REPLACE_")}function Te(){const e=Number(localStorage.getItem("adsgram_disabled_until")||0);return Number.isFinite(e)?e:0}function z(){return Te()>Date.now()}function Fe(e,t=""){try{const n=Date.now()+Math.max(0,e);localStorage.setItem("adsgram_disabled_until",String(n)),console.warn("[AdsGram] Temporarily disabled until",new Date(n).toISOString(),t||"")}catch{}}function J(e){return new Promise((t,n)=>{if(!e||e.startsWith("REPLACE_WITH"))return n(new Error("Script URL is not configured"));if(G.has(e)){const l=G.get(e);if(l==="loaded")return t();if(l&&l.then)return l.then(t).catch(n)}const o=document.querySelector(`script[src="${e}"]`);if(o)return o.dataset.loaded="true",G.set(e,"loaded"),t();const a=document.createElement("script");a.src=e,a.async=!0,a.referrerPolicy="no-referrer-when-downgrade",a.addEventListener("load",()=>{a.dataset.loaded="true",G.set(e,"loaded"),t()}),a.addEventListener("error",()=>{G.delete(e),n(new Error(`Failed to load script ${e}`))}),document.head.appendChild(a);const s=new Promise((l,r)=>{a.addEventListener("load",()=>l()),a.addEventListener("error",()=>r(new Error(`Failed to load script ${e}`)))});G.set(e,s)})}async function re(){if(!j())return console.warn("[AdsGram] blockId is not configured. Skipping init."),null;if(z())return console.warn("[AdsGram] temporarily disabled, skipping init"),null;try{!window.Telegram&&!document.querySelector('script[src="https://telegram.org/js/telegram-web-app.js"]')&&await J("https://telegram.org/js/telegram-web-app.js")}catch(e){console.warn("[AdsGram] Telegram SDK not loaded:",e.message)}if(window.Adsgram&&typeof window.Adsgram.init=="function"||await J(B.adsgram.sdkUrl),!window.Adsgram||typeof window.Adsgram.init!="function")return console.warn("[AdsGram] SDK not available after script load"),null;try{return D=window.Adsgram.init({blockId:B.adsgram.blockId}),D}catch(e){return console.warn("[AdsGram] init failed:",e.message),null}}async function oe(){try{if(D||await re(),!D||!D.show)throw new Error("AdsGram controller not available");return{ok:!0,provider:"adsgram",payload:await D.show()}}catch(e){try{const t=String((e==null?void 0:e.message)||e||"").toLowerCase();(t.includes("not active")||t.includes("moderation"))&&Fe(6*60*60*1e3,"block inactive/moderation")}catch{}return{ok:!1,provider:"adsgram",error:e}}}async function ie(){var e;try{if(!B.monetag.scriptUrl||B.monetag.scriptUrl.startsWith("REPLACE_"))throw new Error("Monetag script URL is not configured");await J(B.monetag.scriptUrl);const t=B.monetag.showFunctionName,n=t&&window[t];if(typeof n!="function")throw new Error(`Monetag show function ${t} is not available`);const o={...B.monetag.defaultOptions};if(Ae())try{const s=(e=window.Telegram.WebApp.initDataUnsafe)==null?void 0:e.user;s&&s.id&&(o.ymid=String(s.id))}catch{}return{ok:!0,provider:"monetag",payload:await n(o)}}catch(t){return{ok:!1,provider:"monetag",error:t}}}function X(){const e=B.rotationKey,t=localStorage.getItem(e);return t==="monetag"||t==="adsgram"?t:(localStorage.setItem(e,"monetag"),"monetag")}function Ue(){const e=B.rotationKey,n=X()==="monetag"?"adsgram":"monetag";return localStorage.setItem(e,n),n}const ce={async init(){j()&&!z()&&re().catch(e=>console.warn("[AdsGram] preload failed:",e.message)),X()},async showRewardedAd(){var s,l,r;const e=[];if(Ie()&&e.push("monetag"),j()&&!z()&&e.push("adsgram"),e.length===0)return{ok:!1,error:{message:"No ad providers configured or available"}};const t=X();let n=e.includes(t)?t:e[0],o=e.find(i=>i!==n);Ue();let a=n==="monetag"?await ie():await oe();if(a.ok)return a;if(o){let i=o==="monetag"?await ie():await oe();return i.ok?i:{ok:!1,error:{first:(s=a.error)==null?void 0:s.message,second:(l=i.error)==null?void 0:l.message}}}return{ok:!1,error:{first:(r=a.error)==null?void 0:r.message}}}},Pe="https://raw.githubusercontent.com/ton-connect/sdk/main/assets/tonconnect-logo.png";function $(...e){console.info("[TonConnect]",...e)}function se(e,t){console.groupCollapsed(`[TonConnect] ${e}`);try{t()}finally{console.groupEnd()}}function R(...e){console.error("[TonConnect]",...e)}let I=null,W=null;const $e=new Set;function Y(e){ne(e),$e.forEach(t=>{try{t(e||null)}catch(n){console.warn("[TonConnect] subscriber error",n)}});try{window.dispatchEvent(new CustomEvent("ton-status",{detail:e||null}))}catch{}}function Re(e){const t=e,n=window.location.href.split("#")[0].split("?")[0],o=n.endsWith("/")?n:`${n.substring(0,n.lastIndexOf("/")+1)}`;try{const s=new URL(t,o).toString();return $("Resolved manifest URL:",s),s}catch(a){R("Manifest URL resolution failed relative to page. Falling back to origin root.",a);try{return new URL(t,window.location.origin+"/").toString()}catch(s){throw new Error(`TonConnect invalid manifest URL: ${s.message}`)}}}function _e(){try{const{origin:e,pathname:t}=window.location,n=t.endsWith("/")?t:t.substring(0,t.lastIndexOf("/")+1);return`${e}${n}`}catch(e){return R("Failed to derive app base URL:",e),null}}function Oe(e,t){if(!e||typeof e!="object")return{manifest:null,changed:!1};const n={...e};let o=!1;const a=_e();n.url||a&&(n.url=a,o=!0),n.name||(n.name=(B==null?void 0:B.appName)||document.title||"TonConnect App",o=!0);const s=typeof n.iconUrl=="string"?n.iconUrl:"";return(!s||s.endsWith(".svg")||s.startsWith("data:image/svg"))&&(n.iconUrl=Pe,o=!0),{manifest:n,changed:o}}async function Ge(e){try{se(`Manifest preflight → ${e}`,()=>{$("Initiating fetch with no-cache headers")});const t=await fetch(e,{method:"GET",cache:"no-store",mode:"cors"});if(!t.ok){const a=await t.text().catch(()=>"<<unreadable>>");throw new Error(`HTTP ${t.status}. Body preview: ${a.slice(0,180)}`)}const n=await t.clone().text().catch(()=>null),o=(()=>{try{return JSON.parse(n||"{}")}catch(a){return R("Manifest JSON parse failed:",a),null}})();return se("Manifest content preview",()=>{$("HTTP status:",t.status,t.statusText),o?$("Fields:",JSON.stringify(o,null,2)):$("Raw text:",n==null?void 0:n.slice(0,500))}),{manifestJson:o,manifestText:n}}catch(t){throw R("Manifest fetch failed:",t),t}}function ne(e){var n;const t=document.getElementById((n=B.tonConnect)==null?void 0:n.addressElementId);if(t)if(e!=null&&e.address){const o=`${e.address.slice(0,6)}...${e.address.slice(-4)}`;t.textContent=o,t.dataset.full=e.address,t.classList.add("connected")}else t.textContent="Не подключено",t.dataset.full="",t.classList.remove("connected")}function De(){var t;const e=document.getElementById((t=B.tonConnect)==null?void 0:t.addressElementId);e&&(e.style.cursor="pointer",e.addEventListener("click",async()=>{const n=e.dataset.full||"";if(n)try{await navigator.clipboard.writeText(n);const o=e.textContent;e.textContent="Copied!",setTimeout(()=>ne((I==null?void 0:I.account)||null)||(e.textContent=o),1e3)}catch(o){console.warn("[TonConnect] clipboard copy failed",o)}}))}async function Ke(){var l,r,i;const e=(l=B.tonConnect)==null?void 0:l.buttonContainerId,t=Re((r=B.tonConnect)==null?void 0:r.manifestUrl),n=await Ge(t);let o=t;const{manifest:a,changed:s}=Oe((n==null?void 0:n.manifestJson)||null);s&&a&&$("Manifest needs adjustments (url/icon). Update the remote file if possible.",a);try{I=new ae({manifestUrl:o,buttonRootId:e,language:"ru"}),$("TonConnectUI instance created. Version:",((i=ae)==null?void 0:i.version)||"unknown")}catch(m){throw R("Failed to create TonConnectUI instance:",m,m==null?void 0:m.stack),m}De(),ne(I.account),I.onStatusChange(m=>{$("Status change → wallet",m?m.account:"null"),Y(m)},m=>{R("Status change error:",m),Y(null)});try{const m=await I.connectionRestored;$("connectionRestored resolved →",m),m&&Y(I.account)}catch(m){R("Connection restoration failed:",m)}return I}function le(){return W||(W=Ke().catch(e=>(R("init failed:",(e==null?void 0:e.message)||e),I=null,W=null,null))),W}function We(){return I}async function qe(){const e=await le();return e||R("ensureTonConnectReady → TonConnectUI unavailable"),e}function He(){var e;I&&((e=I.openModal)==null||e.call(I))}function Ve(e){const t=Number(e);return!Number.isFinite(t)||t<=0?null:BigInt(Math.round(t*1e9)).toString()}async function Ye(){var l,r,i,m,h,b,w,C,S;const e=We()||await qe();if(!e){alert("TonConnect UI не инициализирован. Проверьте manifestUrl.");return}if(!e.account){He(),alert("Подключите TON-кошелёк, чтобы продолжить.");return}const t=(l=B.tonConnect)==null?void 0:l.recipientAddress,n=Ve((i=(r=B.tonConnect)==null?void 0:r.purchase)==null?void 0:i.amount);if(!n){alert("Параметры TON-покупки не настроены.");return}const o={address:t,amount:n},a=(h=(m=B.tonConnect)==null?void 0:m.purchase)==null?void 0:h.payloadHex;a&&(o.payload=a);const s={validUntil:Math.round(Date.now()/1e3)+(((w=(b=B.tonConnect)==null?void 0:b.purchase)==null?void 0:w.ttl)||300),messages:[o]};try{await e.sendTransaction(s);const x=((S=(C=B.tonConnect)==null?void 0:C.purchase)==null?void 0:S.successMessage)||"Платёж в TON отправлен! После подтверждения пополните баланс вручную.";alert(x)}catch(x){console.warn("[TON Purchase] sendTransaction failed",x);const L=(x==null?void 0:x.message)||"Не удалось отправить транзакцию TON.";alert(L)}}function je(){const e=document.getElementById("exchange-modal"),t=document.getElementById("exchange-btn"),n=document.getElementById("close-exchange-btn"),o=document.getElementById("confirm-exchange-btn"),a=document.getElementById("ad-reward-btn"),s=document.getElementById("buy-ton-btn"),l=document.getElementById("from-amount"),r=document.getElementById("from-currency"),i=document.getElementById("to-amount"),m=document.getElementById("to-currency"),h=200;t&&t.addEventListener("click",()=>{e&&(e.style.display="flex")}),n&&n.addEventListener("click",()=>{e&&(e.style.display="none")});const b=()=>{const w=parseFloat((l==null?void 0:l.value)||"0")||0,C=(r==null?void 0:r.value)||"real_balance";let S=0;C==="real_balance"?(m&&(m.value="gcoin"),S=w*h):(m&&(m.value="real_balance"),S=w/h),i&&(i.value=S.toFixed(2))};if(l&&l.addEventListener("input",b),r&&r.addEventListener("change",b),o&&o.addEventListener("click",()=>{const w=parseFloat((l==null?void 0:l.value)||"0")||0,C=(r==null?void 0:r.value)||"real_balance",S=(m==null?void 0:m.value)||"gcoin",x=parseFloat((i==null?void 0:i.value)||"0")||0;if(w<=0){alert("Введите корректную сумму / Please enter a valid amount.");return}if(O.getBalance(C)<w){alert("Недостаточно средств для обмена / Insufficient funds for this exchange.");return}O.subtract(w,C),O.add(x,S),alert("Обмен выполнен! / Exchange successful!"),e&&(e.style.display="none"),l&&(l.value=""),i&&(i.value="")}),a){const w=a.innerHTML;a.addEventListener("click",async()=>{try{a.disabled=!0,a.innerHTML="Поиск рекламы… / Searching for ad…";const C=await ce.showRewardedAd();if(C&&C.ok){const S=C.provider,x=C.payload||{};let L=!1;if(S==="monetag"?L=x&&x.reward_event_type==="valued":S==="adsgram"&&(L=!!x&&x.done===!0),L){const v=Number(B.rewards.perAdUsd||.1);O.add(v,"real_balance"),alert(`Реклама просмотрена! Начислено $${v.toFixed(2)}.
Ad viewed successfully! You've earned $${v.toFixed(2)}.`)}else alert(`Реклама не была досмотрена до конца. Награда не начислена.
Ad was not completed. No reward.`)}else alert(`Ошибка рекламы, попробуйте позже.
Ad error, please try again later.`)}catch(C){console.warn("Ad error:",C),alert(`Ошибка рекламы, попробуйте позже.
Ad error, please try again later.`)}finally{a.disabled=!1,a.innerHTML=w}})}s&&s.addEventListener("click",()=>{Ye()})}window.addEventListener("DOMContentLoaded",()=>{try{window.Telegram&&window.Telegram.WebApp&&typeof window.Telegram.WebApp.ready=="function"&&window.Telegram.WebApp.ready()}catch{}O.init(),fe.init(),Ne(),ce.init(),je(),le(),console.log("App initialized.")});
