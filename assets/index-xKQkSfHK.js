import{T as le}from"./vendor-4QxL1Nz2.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const G={balances:{gcoin:0,real_balance:0},storageKey:"app_wallet",init(){try{const e=localStorage.getItem(this.storageKey);e?this.balances=JSON.parse(e):(this.balances.gcoin=1e3,this.balances.real_balance=5,this.save())}catch(e){console.error("Failed to load wallet from storage",e)}this.updateDisplay()},getBalance(e="gcoin"){return this.balances[e]},updateBalance(e,t){Object.prototype.hasOwnProperty.call(this.balances,e)?(this.balances[e]=t,this.save(),this.updateDisplay()):console.error(`Currency ${e} not found.`)},add(e,t="gcoin"){Object.prototype.hasOwnProperty.call(this.balances,t)&&(this.balances[t]+=e,this.save(),this.updateDisplay())},subtract(e,t="gcoin"){return Object.prototype.hasOwnProperty.call(this.balances,t)&&this.balances[t]>=e?(this.balances[t]-=e,this.save(),this.updateDisplay(),!0):!1},save(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.balances))}catch(e){console.error("Failed to save wallet to storage",e)}},updateDisplay(){const e=document.getElementById("gcoin-balance");if(e)try{e.textContent=this.balances.gcoin.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}catch{e.textContent=String(this.balances.gcoin)}const t=document.getElementById("real-balance-amount");if(t)try{t.textContent=this.balances.real_balance.toLocaleString("en-US",{style:"currency",currency:"USD"})}catch{t.textContent=`$${Number(this.balances.real_balance).toFixed(2)}`}const n=document.getElementById("game-balance-amount");if(n)try{n.textContent=this.balances.gcoin.toLocaleString("en-US")}catch{n.textContent=String(this.balances.gcoin)}}},he={storageKey:"gcoin_settings",config:{sound:!0,backgroundAnimation:!0,soundVolume:45,tonRecipient:""},init(){try{const e=localStorage.getItem(this.storageKey);e&&(this.config=JSON.parse(e));const t=localStorage.getItem("ton_recipient");t&&(this.config.tonRecipient=t)}catch(e){console.error("Failed to load settings from storage",e)}this.applyToUI(),this.listenForChanges(),this.bindWalletStatus()},save(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.config)),console.log("Settings saved:",this.config)}catch(e){console.error("Failed to save settings to storage",e)}},applyToUI(){const e=document.getElementById("sound-toggle"),t=document.getElementById("bg-animation-toggle"),n=document.getElementById("sound-volume"),o=document.getElementById("ton-recipient-input");e&&(e.checked=this.config.sound),t&&(t.checked=this.config.backgroundAnimation),n&&(n.value=this.config.soundVolume),o&&(o.value=this.config.tonRecipient||"")},listenForChanges(){const e=document.getElementById("sound-toggle"),t=document.getElementById("bg-animation-toggle"),n=document.getElementById("sound-volume"),o=document.getElementById("ton-recipient-input");e&&e.addEventListener("change",a=>{this.config.sound=a.target.checked,this.save()}),t&&t.addEventListener("change",a=>{this.config.backgroundAnimation=a.target.checked,this.save()}),n&&n.addEventListener("input",a=>{this.config.soundVolume=Number(a.target.value),this.save()}),o&&o.addEventListener("change",a=>{const i=String(a.target.value||"").trim();this.config.tonRecipient=i;try{localStorage.setItem("ton_recipient",i)}catch{}this.save()})},bindWalletStatus(){const e=document.querySelector(".wallet-placeholder"),t=n=>{if(e)if(n){const o=`${n.slice(0,6)}...${n.slice(-4)}`;e.textContent=`Подключено: ${o}`}else e.textContent="Не подключено"};try{window.addEventListener("ton-status",n=>{var o;t(((o=n==null?void 0:n.detail)==null?void 0:o.address)||null)})}catch{}}},oe={lottery:{key:"lottery",name:"Scratch Lottery",description:"Выберите билет (Bronze/Silver/Gold), купите и сотрите поле монеткой, чтобы узнать выигрыш.",type:"lottery",minBet:10,maxBet:250,defaultBet:25,winChance:.2,winMultiplier:5},coinflip:{key:"coinflip",name:"Coin Flip",description:"Выберите сторону и удвойте ставку при верном угадывании.",type:"coinflip",minBet:10,maxBet:300,defaultBet:20,options:["Орёл","Решка"]},crash:{key:"crash",name:"Crash",description:"Следите за ракетой и выводите до взрыва. Настройте автостоп.",type:"crash",minBet:5,maxBet:500,defaultBet:30,multipliers:[1.5,2,3,5],maxAutoStop:10}};function ie(e,t){const n=oe[e];if(!n)return 0;const o=Number.isFinite(t)?t:n.defaultBet;return Math.min(Math.max(o,n.minBet),n.maxBet)}function ye(e){return oe[e]||null}function se(e,t){const n=oe[e];if(!n)return!1;const o=ie(e,t??n.defaultBet);return G.getBalance("gcoin")>=o}function re(e,t){const n=ie(e,t);if(!G.subtract(n,"gcoin"))throw new Error("Недостаточно gcoin для ставки");return n}function X(e){e>0&&G.add(e,"gcoin")}function we(e,t){const n=ie("coinflip",t),o=Math.random()<.5?"Орёл":"Решка",a=e===o,i=a?n*2:0;return X(i),{win:a,bet:n,reward:i,result:o,message:a?`Вы угадали! Баланс пополнен на ${i.toFixed(2)} gcoin.`:`Выпало "${o}". Ставка проиграна.`}}function be(e,t={}){if(!e)throw new Error("ScratchEngine: hostEl is required");const n={radius:Math.max(6,t.radius||16),cover:t.cover||"#B7BEC5",opacity:t.opacity??1,mode:t.mode==="clear"?"clear":"sealed",progressSampleEvery:t.progressSampleEvery||8,revealFadeMs:t.revealFadeMs||240},o=e.style.position;getComputedStyle(e).position==="static"&&(e.style.position="relative");const a=document.createElement("canvas");a.className="scratch-canvas",a.style.position="absolute",a.style.inset="0",a.style.touchAction="none",a.style.userSelect="none",e.appendChild(a);const i=a.getContext("2d",{willReadFrequently:!0}),s=Math.min(2,window.devicePixelRatio||1);let r=0,l=0;function c(){const h=e.getBoundingClientRect();r=Math.max(1,Math.floor(h.width)),l=Math.max(1,Math.floor(h.height)),a.width=Math.floor(r*s),a.height=Math.floor(l*s),a.style.width=r+"px",a.style.height=l+"px",i.setTransform(s,0,0,s,0,0),p()}function p(){i.globalCompositeOperation="source-over",i.clearRect(0,0,r,l);const h=n.mode==="clear"?.06:n.opacity;i.globalAlpha=h,i.fillStyle=n.cover,i.fillRect(0,0,r,l),i.globalAlpha=1,i.globalCompositeOperation="destination-out"}let f=!1,m=0,E=0,S=0,v=!1;const x=new Set;function g(){const h=B();x.forEach(I=>{try{I(h)}catch{}})}function T(h){f=!0;const{x:I,y:N}=w(h);m=I,E=N,d(I,N),S=0}function A(h){if(!f)return;const{x:I,y:N}=w(h);b(m,E,I,N),m=I,E=N,++S%n.progressSampleEvery===0&&g()}function C(){f&&(f=!1,g())}function w(h){const I=a.getBoundingClientRect(),N=(h.touches?h.touches[0].clientX:h.clientX)??0,R=(h.touches?h.touches[0].clientY:h.clientY)??0;return{x:N-I.left,y:R-I.top}}function d(h,I){i.beginPath(),i.arc(h,I,n.radius,0,Math.PI*2),i.fill()}function b(h,I,N,R){const u=N-h,L=R-I,P=Math.hypot(u,L),Y=Math.max(1,n.radius*.6),D=u/P,z=L/P;for(let H=0;H<=P;H+=Y)d(h+D*H,I+z*H)}function B(){try{const h=Math.max(1,Math.floor(r*s)),I=Math.max(1,Math.floor(l*s)),{data:N}=i.getImageData(0,0,h,I);let R=0;for(let L=3;L<N.length;L+=4)N[L]<16&&R++;const u=h*I;return u?R/u:0}catch{return 0}}function M(h){return typeof h=="function"&&x.add(h),()=>x.delete(h)}function F(){v||(v=!0,a.style.transition=`opacity ${n.revealFadeMs}ms ease`,a.style.opacity="0",setTimeout(()=>{a.remove()},n.revealFadeMs+20),k())}function W(){v=!1,a.style.opacity="1",a.isConnected||e.appendChild(a),p()}function k(){a.removeEventListener("pointerdown",T),window.removeEventListener("pointermove",A),window.removeEventListener("pointerup",C),window.removeEventListener("resize",c)}function V(){k(),a.isConnected&&a.remove(),o&&(e.style.position=o),x.clear()}return a.addEventListener("pointerdown",T),window.addEventListener("pointermove",A,{passive:!0}),window.addEventListener("pointerup",C),window.addEventListener("resize",c),c(),{onProgress:M,getProgressRatio:B,reveal:F,reset:W,destroy:V,canvas:a}}function ve(e){const t="lottery",n=[{id:"bronze",name:"Bronze",color:"#CD7F32",winChance:.08,multiplier:3,price:15},{id:"silver",name:"Silver",color:"#C0C0C0",winChance:.12,multiplier:5,price:25},{id:"gold",name:"Gold",color:"#D4AF37",winChance:.16,multiplier:8,price:40}];let o=n[1],a=o.price,i=null,s=null,r=null,l=!1,c=null;function p(){var C;return(C=e.stageEl)==null?void 0:C.closest(".game-panel")}function f(C){const w=p();w&&(w.classList.toggle("lottery-select-mode",C==="select"),w.classList.toggle("lottery-scratch-mode",C==="scratch"))}function m(){e.configEl&&(e.configEl.innerHTML=""),e.controlsEl&&(e.controlsEl.innerHTML="")}function E(){f("select"),m(),e.stageEl&&(e.stageEl.innerHTML="");const C=document.createElement("div");C.className="lottery-select-grid",n.forEach(w=>{const d=document.createElement("button");d.type="button",d.className="lottery-select-card",d.style.setProperty("--variant-color",w.color),d.innerHTML=`
        <div class="ls-title">
          <span class="ls-name">${w.name}</span>
          <span class="ls-mult">x${w.multiplier}</span>
        </div>
        <div class="ls-meta">
          <span class="ls-price">${w.price.toFixed(2)} gcoin</span>
          <span class="ls-chance">${Math.round(w.winChance*100)}%</span>
        </div>
      `,d.addEventListener("click",()=>x(w)),C.appendChild(d)}),e.stageEl.appendChild(C),e.setStatus("Выберите билет",""),e.setStakeInfo("Ставка: —"),e.setMultiplierInfo(1,!1)}function S(){f("scratch"),m(),i&&(i.destroy(),i=null),e.stageEl.innerHTML="",s=document.createElement("div"),s.className=`ticket-card variant-${o.id}`,s.style.setProperty("--variant-color",o.color);const C=document.createElement("div");C.className="ticket-header",C.innerHTML=`
      <div class="ticket-title">
        <span class="ticket-name">${o.name} Ticket</span>
        <span class="ticket-multiplier">x${o.multiplier}</span>
      </div>
      <div class="ticket-hint">Сотри серое поле монеткой</div>
    `;const w=document.createElement("div");w.className="ticket-body";const d=document.createElement("div");d.className="ticket-result",d.innerHTML='<div class="result-placeholder">Стирайте, чтобы узнать результат</div>',w.appendChild(d),s.appendChild(C),s.appendChild(w),e.stageEl.appendChild(s),v(),e.setStakeInfo(a),e.setMultiplierInfo(o.multiplier,!0),e.setStatus("Стирайте монеткой серое поле, чтобы узнать результат…","");const b=document.createElement("div");b.className="lottery-scratch-actions",c=document.createElement("button"),c.type="button",c.className="btn btn-primary",c.textContent="Стирайте…",c.disabled=!0,c.addEventListener("click",()=>{c.disabled||x(o)}),b.appendChild(c),e.stageEl.appendChild(b)}function v(){if(!s)return;i&&(i.destroy(),i=null);const C=s.querySelector(".ticket-body");i=be(C,{radius:22,cover:"#C1C7CE",mode:"sealed"}),i.onProgress(w=>{!l&&w>.6&&(l=!0,i.reveal(),g())})}function x(C){if(o=C,a=o.price,!se(t,a)){e.setStatus("Недостаточно gcoin для покупки билета.","lose");return}const w=re(t,a),d=Math.random()<o.winChance,b=d?w*o.multiplier:0;r={win:d,bet:w,reward:b,multiplier:o.multiplier,message:d?`Повезло! Выигрыш ${b.toFixed(2)} gcoin (x${o.multiplier}).`:"Увы, без выигрыша. Попробуйте другой билет!"},S();const B=s.querySelector(".ticket-result");B.innerHTML=d?`<div class="result-win">ДЖЕКПОТ!<br><span class="amount">+${b.toFixed(2)} gcoin</span></div>`:'<div class="result-lose">Не выиграл</div>',l=!1}function g(){r&&(r.reward>0&&X(r.reward),e.setStatus(r.message,r.win?"win":"lose"),c&&(c.disabled=!1,c.textContent=`Купить ещё за ${a.toFixed(2)} gcoin`))}function T(){E()}function A(){const C=p();C&&(C.classList.remove("lottery-select-mode"),C.classList.remove("lottery-scratch-mode")),i&&(i.destroy(),i=null),s=null,r=null,l=!1,c=null,e.stageEl&&(e.stageEl.innerHTML=""),m()}return{mount:T,destroy:A}}function Ee(e){const t="coinflip",n=e.info;let o=n.defaultBet,a="Орёл",i=!1,s=null,r=null,l=null;const c=()=>{var d;return(d=e.stageEl)==null?void 0:d.closest(".game-panel")},p=d=>{const b=c();b&&b.classList.toggle("coin-minimal-mode",!0)},f=()=>{e.configEl&&(e.configEl.innerHTML=""),e.controlsEl&&(e.controlsEl.innerHTML="")},m=()=>{s&&(clearTimeout(s),s=null)},E=d=>{o=Number(d),Number.isFinite(o)||(o=n.defaultBet),o=Math.min(Math.max(o,n.minBet),n.maxBet),e.setStakeInfo(o)},S=d=>{a=d},v=d=>d==="Решка"?"tails":"heads",x=()=>{const d=document.createElement("div");return d.className="coin-stake-chips",Array.from(new Set([n.minBet,n.defaultBet,Math.round((n.minBet+n.maxBet)/2),n.maxBet])).filter(Number.isFinite).sort((B,M)=>B-M).forEach(B=>{const M=document.createElement("button");M.type="button",M.className="coin-stake-chip",M.textContent=`${B}`,B===o&&M.classList.add("active"),M.addEventListener("click",()=>{o=B,e.setStakeInfo(o),d.querySelectorAll(".coin-stake-chip").forEach(F=>F.classList.remove("active")),M.classList.add("active")}),d.appendChild(M)}),d},g=()=>{const d=document.createElement("div");d.className="coin-stage";const b=document.createElement("div");b.className="coin",b.dataset.side=v(a);const B=document.createElement("div");B.className="coin-face coin-front",B.textContent="";const M=document.createElement("div");M.className="coin-face coin-back",M.textContent="",b.appendChild(B),b.appendChild(M),d.appendChild(b);const F=document.createElement("div");F.className="coin-stake-controls";const W=x(),k=document.createElement("input");return k.type="number",k.className="coin-stake-input",k.min=String(n.minBet),k.max=String(n.maxBet),k.step="1",k.placeholder=String(o),k.value=String(o),k.addEventListener("change",V=>{const h=Number(V.target.value);Number.isFinite(h)&&(o=Math.min(Math.max(h,n.minBet),n.maxBet),e.setStakeInfo(o),W.querySelectorAll(".coin-stake-chip").forEach(I=>I.classList.toggle("active",Number(I.textContent)===o)),k.value=String(o))}),F.appendChild(W),F.appendChild(k),d.appendChild(F),r=b,r.addEventListener("click",A),d},T=(d,b)=>{if(!r)return;r.classList.remove("coin-win","coin-lose"),r.classList.add("coin-flip");const B=b.win;s=setTimeout(()=>{r.classList.remove("coin-flip"),r.style.transform=d==="Решка"?"rotateY(180deg)":"rotateY(0deg)",r.dataset.side=v(d),r.classList.add(B?"coin-win":"coin-lose"),e.setStatus(b.message,B?"win":"lose"),i=!1,r.style.pointerEvents="",l&&(l.disabled=!1,l.textContent="Бросить монету")},1500)},A=()=>{if(i)return;if(!se(t,o)){e.setStatus("Недостаточно gcoin для ставки.","lose");return}const d=re(t,o),b=we(a,d);e.setStatus("Монета в полёте...",""),i=!0,r.style.pointerEvents="none",m(),T(b.result,b)},C=()=>{p(),f(),e.stageEl.appendChild(g()),e.setStatus("",""),e.setMultiplierInfo(1,!1)},w=()=>{m(),r=null,l=null,i=!1;const d=c();d&&d.classList.remove("coin-minimal-mode")};return E(o),S(a),{mount:C,destroy:w}}function Ce(e){var R;const t="crash",n=e.info;let o=n.defaultBet,a=((R=n.multipliers)==null?void 0:R[1])||2,i=!1,s=null,r=null,l=null,c=null,p=null,f=null,m=null,E=0,S=0,v=!1,x=!1,g=0,T=0;const A=()=>{var u;return(u=e.stageEl)==null?void 0:u.closest(".game-panel")},C=u=>{const L=A();L&&L.classList.toggle("crash-minimal-mode",!0)},w=()=>{e.configEl&&(e.configEl.innerHTML=""),e.controlsEl&&(e.controlsEl.innerHTML="")},d=u=>{o=Number(u),Number.isFinite(o)||(o=n.defaultBet),o=Math.min(Math.max(o,n.minBet),n.maxBet),e.setStakeInfo(o)},b=u=>{var L;a=Number(u),Number.isFinite(a)||(a=((L=n.multipliers)==null?void 0:L[0])||1.5),a=Math.min(Math.max(a,1.1),n.maxAutoStop||10),e.setMultiplierInfo(a,!0)},B=()=>{const u=document.createElement("div");u.className="crash-stage";const L=document.createElement("div");L.className="crash-meter";const P=document.createElement("div");return P.className="crash-meter-value",P.textContent="x1.00",L.appendChild(P),u.appendChild(L),r=L,l=P,M(),u};function M(){!r||!l||(r.classList.remove("win","lose","active"),l.textContent="x1.00")}function F(u,L){!r||!l||(l.textContent=`x${u.toFixed(2)}`,L==="active"?(r.classList.add("active"),r.classList.remove("win","lose")):L==="win"?(r.classList.add("win"),r.classList.remove("lose","active")):L==="lose"&&(r.classList.add("lose"),r.classList.remove("win","active")))}function W(u){return u<=0?1:u<=2?1+.05*u:u<=3?1.1+.1*(u-2):u<=4?1.2+.2*(u-3):1.4+.3*(u-4)}function k(u){return u<=1?0:u<=1.1?(u-1)/.05:u<=1.2?2+(u-1.1)/.1:u<=1.4?3+(u-1.2)/.2:4+(u-1.4)/.3}const V=()=>{if(i)return;if(!se(t,o)){e.setStatus("Недостаточно gcoin для ставки.","lose");return}S=re(t,o),i=!0,v=!1,x=!1,M(),F(1,"active"),e.setStatus("",""),c&&(c.disabled=!0),p&&(p.disabled=!1);const u=(n==null?void 0:n.volatility)||3.2,L=1+Math.random()*u;g=Number(L.toFixed(2)),T=k(g),E=performance.now();const P=()=>{const D=(performance.now()-E)/1e3,z=W(D),H=D>=T&&!v&&!x;if(!v&&!x&&z>=a){const ge=Number((S*a).toFixed(2));X(ge),x=!0,i=!1,F(a,"win"),e.setStatus("",""),c&&(c.disabled=!1),p&&(p.disabled=!0);return}if(H){v=!0,i=!1,F(g,"lose"),e.setStatus("",""),c&&(c.disabled=!1),p&&(p.disabled=!0);return}F(z,"active"),s=requestAnimationFrame(P)};s=requestAnimationFrame(P)},h=()=>{const u=document.createElement("div");return u.className="crash-actions",f=document.createElement("input"),f.type="number",f.min=String(n.minBet),f.max=String(n.maxBet),f.step="1",f.value=String(o),f.className="crash-input",f.placeholder="Ставка",f.addEventListener("change",L=>{d(Number(L.target.value)),f.value=String(o)}),m=document.createElement("input"),m.type="number",m.min="1.1",m.max=String(n.maxAutoStop||10),m.step="0.1",m.value=String(a),m.className="crash-input",m.placeholder="Автостоп",m.addEventListener("change",L=>{b(Number(L.target.value)),m.value=String(a)}),c=document.createElement("button"),c.type="button",c.className="btn btn-primary",c.textContent="Старт",c.addEventListener("click",V),p=document.createElement("button"),p.type="button",p.className="btn btn-secondary",p.textContent="Вывести",p.disabled=!0,p.addEventListener("click",()=>{if(!i||v||x)return;const P=(performance.now()-E)/1e3,Y=W(P),D=Number((S*Y).toFixed(2));X(D),x=!0,i=!1,F(Y,"win"),e.setStatus("",""),c&&(c.disabled=!1),p&&(p.disabled=!0)}),u.appendChild(f),u.appendChild(m),u.appendChild(c),u.appendChild(p),u},I=()=>{C(),w(),e.stageEl.appendChild(B()),e.controlsEl.appendChild(h()),e.setStatus("","")},N=()=>{cancelAnimationFrame(s),s=null,r=null,l=null,c=null,p=null,f=null,m=null,i=!1;const u=A();u&&u.classList.remove("crash-minimal-mode")};return d(o),b(a),{mount:I,destroy:N}}const Se={lottery:ve,coinflip:Ee,crash:Ce};function Le({titleEl:e,descriptionEl:t,configEl:n,stageEl:o,controlsEl:a,statusEl:i,stakeInfoEl:s,multiplierInfoEl:r}){const l={activeKey:null,activeInstance:null},c=g=>{g&&(g.innerHTML="")},p=(g="",T="")=>{i&&(i.textContent=g,i.classList.remove("game-result-win","game-result-lose"),T==="win"?i.classList.add("game-result-win"):T==="lose"&&i.classList.add("game-result-lose"))},f=g=>{s&&(typeof g=="number"?s.textContent=`Ставка: ${g.toFixed(2)} gcoin`:s.textContent=g||"Ставка: —")},m=(g,T=!0)=>{if(r){if(!T){r.style.display="none";return}r.style.display="",r.textContent=`Множитель: x${Number(g||1).toFixed(2)}`}},E=()=>{if(p("Выберите игру, чтобы начать раунд.",""),f("Ставка: —"),m(1,!1),c(n),c(o),c(a),o){const g=document.createElement("div");g.className="game-placeholder",g.textContent="Выберите игру из главного зала",o.appendChild(g)}},S=()=>{l.activeInstance&&typeof l.activeInstance.destroy=="function"&&l.activeInstance.destroy(),l.activeInstance=null,l.activeKey=null},v=g=>{var d;const T=Se[g],A=ye(g);if(!T||!A){console.warn("[GameManager] Unknown game key:",g);return}if(S(),c(n),c(o),c(a),p("Настройте параметры и нажмите старт.",""),typeof A.defaultBet=="number"?f(A.defaultBet):typeof A.minBet=="number"?f(A.minBet):f("Ставка: —"),A.type==="crash"){const b=((d=A.multipliers)==null?void 0:d[0])||1.5;m(b,!0)}else m(1,!1);e&&(e.textContent=A.name),t&&(t.textContent=A.description);const w=T({configEl:n,stageEl:o,controlsEl:a,setStatus:p,setStakeInfo:f,setMultiplierInfo:m,info:A});w&&typeof w.mount=="function"?(w.mount(),l.activeInstance=w,l.activeKey=g):(console.warn("[GameManager] Invalid game instance for key:",g),E())},x=()=>{S(),e&&(e.textContent="Выберите игру"),t&&(t.textContent="Откройте игру из каталога, чтобы начать."),E()};return x(),{openGame:v,reset:x,hasActiveGame:()=>!!l.activeKey,getActiveGameKey:()=>l.activeKey}}function xe(e){const t={home:document.getElementById("home-view"),game:document.getElementById("game-view"),wallet:document.getElementById("wallet-view")},n=document.querySelectorAll(".nav-item"),o=()=>{Object.values(t).forEach(s=>{s&&(s.style.display="none")})},a=s=>{n.forEach(r=>{r.classList.toggle("active",r.dataset.view===s)})},i=s=>{o();const r=t[s]||t.home;r&&(r.style.display="flex")};return n.forEach(s=>{const r=s.dataset.view||"home";s.addEventListener("click",l=>{l.preventDefault(),i(r),a(r),r==="home"&&e.reset()})}),i("home"),a("home"),{switchView:i,updateNavActive:a}}function Ie(){const e=document.getElementById("settings-modal"),t=document.querySelector(".settings-btn"),n=document.getElementById("close-settings-btn");t&&t.addEventListener("click",()=>{e&&(e.style.display="flex")}),n&&n.addEventListener("click",()=>{e&&(e.style.display="none")}),e&&e.addEventListener("click",o=>{o.target===e&&(e.style.display="none")})}function Ae(){return Le({titleEl:document.getElementById("active-game-title"),descriptionEl:document.getElementById("active-game-description"),configEl:document.getElementById("game-config"),stageEl:document.getElementById("game-stage"),controlsEl:document.getElementById("game-controls"),statusEl:document.getElementById("game-status"),stakeInfoEl:document.getElementById("game-stake-info"),multiplierInfoEl:document.getElementById("game-multiplier-info")})}function Be(e,t){document.querySelectorAll(".game-card").forEach(o=>{o.addEventListener("click",()=>{const a=o.dataset.game;a&&(t.switchView("game"),t.updateNavActive("game"),e.openGame(a))})})}function Me(e,t){const n=document.getElementById("back-to-library");n&&n.addEventListener("click",()=>{e.reset(),t.switchView("home"),t.updateNavActive("home")})}function Te(){const e=Ae(),t=xe(e);Ie(),Be(e,t),Me(e,t)}const y={adsgram:{blockId:"15234",sdkUrl:"https://sad.adsgram.ai/js/sad.min.js"},monetag:{scriptUrl:"REPLACE_WITH_MONETAG_SCRIPT_URL",showFunctionName:"REPLACE_WITH_SHOW_FUNCTION",defaultOptions:{type:"end",requestVar:"ad_reward_button",timeout:15e3,catchIfNoFeed:!0}},richads:{scriptUrl:"https://richinfo.co/richpartners/telegram/js/tg-ob.js",pubId:"REPLACE_PUB_ID",appId:"REPLACE_APP_ID"},mybid:{apiBase:"https://publishers.mybid.io/backend/api/public",token:"REPLACE_MYBID_TOKEN",requestTimeoutMs:8e3},tonConnect:{manifestUrl:"https://singidranta.github.io/CasinoCash-App.io/tonconnect-manifest.json",buttonContainerId:"ton-connect-button",addressElementId:"ton-address",recipientAddress:"EQC-your-ton-address",purchase:{amount:"2",currency:"TON",description:"Gcoin top-up"}},rewards:{perAdUsd:.1},rotationKey:"ad_rotation_pref",monetagMaxConsecutive:5};function ke(e,t){return new Promise((n,o)=>{const a=setTimeout(()=>o(new Error("MyBid request timed out")),t);e.then(i=>{clearTimeout(a),n(i)}).catch(i=>{clearTimeout(a),o(i)})})}async function Z(e,t={}){var l,c,p;const n=(l=y.mybid)==null?void 0:l.apiBase,o=(c=y.mybid)==null?void 0:c.token,a=new URL(e,n.endsWith("/")?n:n+"/");Object.entries(t).forEach(([f,m])=>{m!=null&&m!==""&&a.searchParams.set(f,String(m))}),a.searchParams.get("token")||a.searchParams.set("token",o);const i=fetch(a.toString(),{method:"GET",headers:{Accept:"application/json"},credentials:"omit"}),s=(p=y.mybid)==null?void 0:p.requestTimeoutMs,r=await ke(i,s);if(!r.ok){const f=await r.text().catch(()=>"");throw new Error(`MyBid HTTP ${r.status} ${r.statusText} ${f==null?void 0:f.slice(0,140)}`)}return r.json().catch(()=>({}))}const Ne={async stats({date1:e,date2:t,fields:n="date,impressions,clicks,money",orderBy:o="-date",limit:a=100,offset:i=0,filters:s=""}={}){return Z("stats",{date1:e,date2:t,fields:n,orderBy:o,limit:a,offset:i,filters:s})},async spots(){return Z("user-spots")},async health(){var i;const e=new Date,t=s=>s.toISOString().slice(0,10),n=t(e),o=new Date(e.getTime()-24*60*60*1e3),a=t(o);try{const s=await Z("stats",{date1:a,date2:n,fields:"date,impressions",orderBy:"-date",limit:1,offset:0});return Array.isArray((s==null?void 0:s.data)||s)?((i=s.data)==null?void 0:i.length)>0||s.length>0:!0}catch{return!1}}};function te(){return!String(y.richads.scriptUrl).startsWith("REPLACE_")&&!0&&!String(y.richads.pubId).startsWith("REPLACE_")&&!0&&!String(y.richads.appId).startsWith("REPLACE_")}async function ue(){if(!te())return null;try{if(await Q(y.richads.scriptUrl),!window.TelegramAdsController)throw new Error("TelegramAdsController is not available");return U||(U=new window.TelegramAdsController,U.initialize({pubId:y.richads.pubId,appId:y.richads.appId})),U}catch(e){return console.warn("[RichAds] init failed:",e.message),null}}async function _e(){try{if(U||await ue(),!U)throw new Error("No RichAds controller");const e=["showRewarded","showInterstitial","show","run"];let t=null;for(const o of e)if(typeof U[o]=="function"){t=U[o].bind(U);break}if(!t)throw new Error("No show method on RichAds controller");return{ok:!0,provider:"richads",payload:await Promise.resolve(t())}}catch(e){return{ok:!1,provider:"richads",error:e}}}function Fe(){return!String(y.mybid.token).startsWith("REPLACE_")}async function Pe(){if(!Fe())return!1;try{return!!await Ne.health()}catch{return!1}}const K=new Map;let j=null,U=null,q=0;function Re(){return typeof window<"u"&&window.Telegram&&window.Telegram.WebApp}function Ue(){return!String(y.monetag.scriptUrl).startsWith("REPLACE_")&&!0}function ne(){return!String(y.adsgram.blockId).startsWith("REPLACE_")}function Oe(){const e=Number(localStorage.getItem("adsgram_disabled_until")||0);return Number.isFinite(e)?e:0}function ae(){return Oe()>Date.now()}function $e(e,t=""){try{const n=Date.now()+Math.max(0,e);localStorage.setItem("adsgram_disabled_until",String(n)),console.warn("[AdsGram] Temporarily disabled until",new Date(n).toISOString(),t||"")}catch{}}function Q(e){return new Promise((t,n)=>{if(!e||e.startsWith("REPLACE_WITH"))return n(new Error("Script URL is not configured"));if(K.has(e)){const s=K.get(e);if(s==="loaded")return t();if(s&&s.then)return s.then(t).catch(n)}const o=document.querySelector(`script[src="${e}"]`);if(o)return o.dataset.loaded="true",K.set(e,"loaded"),t();const a=document.createElement("script");a.src=e,a.async=!0,a.referrerPolicy="no-referrer-when-downgrade",a.addEventListener("load",()=>{a.dataset.loaded="true",K.set(e,"loaded"),t()}),a.addEventListener("error",()=>{K.delete(e),n(new Error(`Failed to load script ${e}`))}),document.head.appendChild(a);const i=new Promise((s,r)=>{a.addEventListener("load",()=>s()),a.addEventListener("error",()=>r(new Error(`Failed to load script ${e}`)))});K.set(e,i)})}async function me(){if(!ne())return console.warn("[AdsGram] blockId is not configured. Skipping init."),null;if(ae())return console.warn("[AdsGram] temporarily disabled, skipping init"),null;try{!window.Telegram&&!document.querySelector('script[src="https://telegram.org/js/telegram-web-app.js"]')&&await Q("https://telegram.org/js/telegram-web-app.js")}catch(e){console.warn("[AdsGram] Telegram SDK not loaded:",e.message)}if(window.Adsgram&&typeof window.Adsgram.init=="function"||await Q(y.adsgram.sdkUrl),!window.Adsgram||typeof window.Adsgram.init!="function")return console.warn("[AdsGram] SDK not available after script load"),null;try{return j=window.Adsgram.init({blockId:y.adsgram.blockId}),j}catch(e){return console.warn("[AdsGram] init failed:",e.message),null}}async function Ge(){try{if(j||await me(),!j||!j.show)throw new Error("AdsGram controller not available");return{ok:!0,provider:"adsgram",payload:await j.show()}}catch(e){try{const t=String((e==null?void 0:e.message)||e||"").toLowerCase();(t.includes("not active")||t.includes("moderation"))&&$e(6*60*60*1e3,"block inactive/moderation")}catch{}return{ok:!1,provider:"adsgram",error:e}}}async function We(){var e;try{if(!y.monetag.scriptUrl||y.monetag.scriptUrl.startsWith("REPLACE_"))throw new Error("Monetag script URL is not configured");await Q(y.monetag.scriptUrl);const t=y.monetag.showFunctionName,n=t&&window[t];if(typeof n!="function")throw new Error(`Monetag show function ${t} is not available`);const o={...y.monetag.defaultOptions};if(Re())try{const i=(e=window.Telegram.WebApp.initDataUnsafe)==null?void 0:e.user;i&&i.id&&(o.ymid=String(i.id))}catch{}return{ok:!0,provider:"monetag",payload:await n(o)}}catch(t){return{ok:!1,provider:"monetag",error:t}}}function De(){const e=y.rotationKey,t=localStorage.getItem(e);return t==="monetag"||t==="adsgram"?t:(localStorage.setItem(e,"monetag"),"monetag")}const fe={async init(){ne()&&!ae()&&me().catch(e=>console.warn("[AdsGram] preload failed:",e.message)),te()&&ue().catch(e=>console.warn("[RichAds] preload failed:",e.message)),De();try{q=Number(localStorage.getItem("monetag_consecutive_count")||"0")||0}catch{q=0}},async showRewardedAd(){var s;const e=Ue(),t=te(),n=ne()&&!ae();if(!e&&!t&&!n)return{ok:!1,error:{message:await Pe()?"No ad SDKs configured":"Ad backends unavailable"}};const o=e&&q<y.monetagMaxConsecutive,a=[];o&&a.push("monetag"),t&&a.push("richads"),n&&a.push("adsgram"),!o&&e&&a.push("monetag");let i=null;for(const r of a){let l;if(r==="monetag"?l=await We():r==="richads"?l=await _e():l=await Ge(),l.ok){l.provider==="monetag"?q+=1:q=0;try{localStorage.setItem("monetag_consecutive_count",String(q))}catch{}return l}i=((s=l.error)==null?void 0:s.message)||String(l.error||"unknown error")}return{ok:!1,error:{message:i||"All providers failed"}}}},He="https://raw.githubusercontent.com/ton-connect/sdk/main/assets/tonconnect-logo.png";function O(...e){console.info("[TonConnect]",...e)}function de(e,t){console.groupCollapsed(`[TonConnect] ${e}`);try{t()}finally{console.groupEnd()}}function $(...e){console.error("[TonConnect]",...e)}let _=null,J=null;const Ke=new Set;function ee(e){const t=e&&e.account?e.account:e;ce(t),Ke.forEach(n=>{try{n(t||null)}catch(o){console.warn("[TonConnect] subscriber error",o)}});try{window.dispatchEvent(new CustomEvent("ton-status",{detail:t||null}))}catch{}}function qe(e){const t=e,n=window.location.href.split("#")[0].split("?")[0],o=n.endsWith("/")?n:`${n.substring(0,n.lastIndexOf("/")+1)}`;try{const i=new URL(t,o).toString();return O("Resolved manifest URL:",i),i}catch(a){$("Manifest URL resolution failed relative to page. Falling back to origin root.",a);try{return new URL(t,window.location.origin+"/").toString()}catch(i){throw new Error(`TonConnect invalid manifest URL: ${i.message}`)}}}function je(){try{const{origin:e,pathname:t}=window.location,n=t.endsWith("/")?t:t.substring(0,t.lastIndexOf("/")+1);return`${e}${n}`}catch(e){return $("Failed to derive app base URL:",e),null}}function Ve(e,t){if(!e||typeof e!="object")return{manifest:null,changed:!1};const n={...e};let o=!1;const a=je();n.url||a&&(n.url=a,o=!0),n.name||(n.name=(y==null?void 0:y.appName)||document.title||"TonConnect App",o=!0);const i=typeof n.iconUrl=="string"?n.iconUrl:"";return(!i||i.endsWith(".svg")||i.startsWith("data:image/svg"))&&(n.iconUrl=He,o=!0),{manifest:n,changed:o}}async function Ye(e){try{de(`Manifest preflight → ${e}`,()=>{O("Initiating fetch with no-cache headers")});const t=await fetch(e,{method:"GET",cache:"no-store",mode:"cors"});if(!t.ok){const a=await t.text().catch(()=>"<<unreadable>>");throw new Error(`HTTP ${t.status}. Body preview: ${a.slice(0,180)}`)}const n=await t.clone().text().catch(()=>null),o=(()=>{try{return JSON.parse(n||"{}")}catch(a){return $("Manifest JSON parse failed:",a),null}})();return de("Manifest content preview",()=>{O("HTTP status:",t.status,t.statusText),o?O("Fields:",JSON.stringify(o,null,2)):O("Raw text:",n==null?void 0:n.slice(0,500))}),{manifestJson:o,manifestText:n}}catch(t){throw $("Manifest fetch failed:",t),t}}function ce(e){var n;const t=document.getElementById((n=y.tonConnect)==null?void 0:n.addressElementId);if(t)if(e!=null&&e.address){const o=`${e.address.slice(0,6)}...${e.address.slice(-4)}`;t.textContent=o,t.dataset.full=e.address,t.classList.add("connected")}else t.textContent="Не подключено",t.dataset.full="",t.classList.remove("connected")}function ze(){var t;const e=document.getElementById((t=y.tonConnect)==null?void 0:t.addressElementId);e&&(e.style.cursor="pointer",e.addEventListener("click",async()=>{const n=e.dataset.full||"";if(n)try{await navigator.clipboard.writeText(n);const o=e.textContent;e.textContent="Copied!",setTimeout(()=>ce((_==null?void 0:_.account)||null)||(e.textContent=o),1e3)}catch(o){console.warn("[TonConnect] clipboard copy failed",o)}}))}async function Je(){var s,r,l;const e=(s=y.tonConnect)==null?void 0:s.buttonContainerId,t=qe((r=y.tonConnect)==null?void 0:r.manifestUrl),n=await Ye(t);let o=t;const{manifest:a,changed:i}=Ve((n==null?void 0:n.manifestJson)||null);i&&a&&O("Manifest needs adjustments (url/icon). Update the remote file if possible.",a);try{_=new le({manifestUrl:o,buttonRootId:e,language:"ru"}),O("TonConnectUI instance created. Version:",((l=le)==null?void 0:l.version)||"unknown")}catch(c){throw $("Failed to create TonConnectUI instance:",c,c==null?void 0:c.stack),c}ze(),ce(_.account),_.onStatusChange(c=>{O("Status change → wallet",c?c.account:"null"),ee(c)},c=>{$("Status change error:",c),ee(null)});try{const c=await _.connectionRestored;O("connectionRestored resolved →",c),c&&ee(_.account)}catch(c){$("Connection restoration failed:",c)}return _}function pe(){return J||(J=Je().catch(e=>($("init failed:",(e==null?void 0:e.message)||e),_=null,J=null,null))),J}function Xe(){return _}async function Qe(){const e=await pe();return e||$("ensureTonConnectReady → TonConnectUI unavailable"),e}function Ze(){var e;_&&((e=_.openModal)==null||e.call(_))}function et(e){const t=Number(e);return!Number.isFinite(t)||t<=0?null:BigInt(Math.round(t*1e9)).toString()}async function tt(){var s,r,l,c,p,f,m,E,S;const e=Xe()||await Qe();if(!e){alert("TonConnect UI не инициализирован. Проверьте manifestUrl.");return}if(!e.account){Ze(),alert("Подключите TON-кошелёк, чтобы продолжить.");return}const t=localStorage.getItem("ton_recipient")||((s=y.tonConnect)==null?void 0:s.recipientAddress),n=et((l=(r=y.tonConnect)==null?void 0:r.purchase)==null?void 0:l.amount);if(!n){alert("Параметры TON-покупки не настроены.");return}const o={address:t,amount:n},a=(p=(c=y.tonConnect)==null?void 0:c.purchase)==null?void 0:p.payloadHex;a&&(o.payload=a);const i={validUntil:Math.round(Date.now()/1e3)+(((m=(f=y.tonConnect)==null?void 0:f.purchase)==null?void 0:m.ttl)||300),messages:[o]};try{await e.sendTransaction(i);const v=((S=(E=y.tonConnect)==null?void 0:E.purchase)==null?void 0:S.successMessage)||"Платёж в TON отправлен! После подтверждения пополните баланс вручную.";alert(v)}catch(v){console.warn("[TON Purchase] sendTransaction failed",v);const x=(v==null?void 0:v.message)||"Не удалось отправить транзакцию TON.";alert(x)}}function nt(){const e=document.getElementById("exchange-modal"),t=document.getElementById("exchange-btn"),n=document.getElementById("close-exchange-btn"),o=document.getElementById("confirm-exchange-btn"),a=document.getElementById("ad-reward-btn"),i=document.getElementById("buy-ton-btn"),s=document.getElementById("from-amount"),r=document.getElementById("from-currency"),l=document.getElementById("to-amount"),c=document.getElementById("to-currency"),p=200;t&&t.addEventListener("click",()=>{e&&(e.style.display="flex")}),n&&n.addEventListener("click",()=>{e&&(e.style.display="none")});const f=()=>{const m=parseFloat((s==null?void 0:s.value)||"0")||0,E=(r==null?void 0:r.value)||"real_balance";let S=0;E==="real_balance"?(c&&(c.value="gcoin"),S=m*p):(c&&(c.value="real_balance"),S=m/p),l&&(l.value=S.toFixed(2))};if(s&&s.addEventListener("input",f),r&&r.addEventListener("change",f),o&&o.addEventListener("click",()=>{const m=parseFloat((s==null?void 0:s.value)||"0")||0,E=(r==null?void 0:r.value)||"real_balance",S=(c==null?void 0:c.value)||"gcoin",v=parseFloat((l==null?void 0:l.value)||"0")||0;if(m<=0){alert("Введите корректную сумму / Please enter a valid amount.");return}if(G.getBalance(E)<m){alert("Недостаточно средств для обмена / Insufficient funds for this exchange.");return}G.subtract(m,E),G.add(v,S),alert("Обмен выполнен! / Exchange successful!"),e&&(e.style.display="none"),s&&(s.value=""),l&&(l.value="")}),a){const m=a.innerHTML;a.addEventListener("click",async()=>{try{a.disabled=!0,a.innerHTML="Поиск рекламы… / Searching for ad…";const E=await fe.showRewardedAd();if(E&&E.ok){const S=E.provider,v=E.payload||{};let x=!1;if(S==="monetag"?x=v&&v.reward_event_type==="valued":S==="adsgram"?x=!!v&&v.done===!0:S==="richads"&&(x=!0),x){const g=Number(y.rewards.perAdUsd||.1);G.add(g,"real_balance"),alert(`Реклама (${S}) просмотрена! Начислено $${g.toFixed(2)}.
Ad viewed successfully! Provider: ${S}. You've earned $${g.toFixed(2)}.`)}else alert(`Реклама не была досмотрена до конца или не засчитана. Награда не начислена.
Ad was not completed or not eligible.`)}else alert(`Ошибка рекламы, попробуйте позже.
Ad error, please try again later.`)}catch(E){console.warn("Ad error:",E),alert(`Ошибка рекламы, попробуйте позже.
Ad error, please try again later.`)}finally{a.disabled=!1,a.innerHTML=m}})}i&&i.addEventListener("click",()=>{tt()})}window.addEventListener("DOMContentLoaded",()=>{try{window.Telegram&&window.Telegram.WebApp&&typeof window.Telegram.WebApp.ready=="function"&&window.Telegram.WebApp.ready()}catch{}G.init(),he.init(),Te(),fe.init(),nt(),pe(),console.log("App initialized.")});
